<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.96">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rappels sur les macros</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../formation/formation22.html" rel="next">
<link href="../formation/formation14.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://mthevenin.github.io/stata_fr/">Stata Ined</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mthevenin.github.io/stata_graphiques/">Graphiques</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://mthevenin.github.io/stata_programmation">Programmation</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mthevenin"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:marc.thevenin@ined.fr"><i class="bi bi-envelope" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">A propos</a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Rappels sur les macros</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Formation</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../formation/formation.html" class="sidebar-item-text sidebar-link">Introduction</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">Chapitre 1: syntaxe</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../formation/formation11.html" class="sidebar-item-text sidebar-link">Types et syntaxe</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../formation/formation12.html" class="sidebar-item-text sidebar-link">Options: couleur, épaisseur</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../formation/formation13.html" class="sidebar-item-text sidebar-link"><strong>Options: axes, légende…</strong></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../formation/formation14.html" class="sidebar-item-text sidebar-link">Combiner des graphiques</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Chapitre 2: macros</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../formation/formation21.html" class="sidebar-item-text sidebar-link active">Rappels sur les macros</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../formation/formation22.html" class="sidebar-item-text sidebar-link">Alleger la syntaxe</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../formation/formation23.html" class="sidebar-item-text sidebar-link">Automatiser la programmation</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">Chapitre 3: palettes et styles</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../formation/formation31.html" class="sidebar-item-text sidebar-link">Palettes de couleurs</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../formation/formation32.html" class="sidebar-item-text sidebar-link">Styles-thèmes</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">Chapitre 4: [A venir]</span>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">Chapitre 5: [A venir]</span>
  </li>
          <li class="sidebar-item">
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">Ressources graphiques</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Stata.html" class="sidebar-item-text sidebar-link">Programmation avec Stata</a>
  </div>
</li>
          <li class="sidebar-item">
  Python.qmd
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul>
  <li><a href="#local---global" id="toc-local---global" class="nav-link active" data-scroll-target="#local---global"><span class="toc-section-number">1</span>  <strong>local - global</strong></a>
  <ul class="collapse">
  <li><a href="#macro-temporaire-local" id="toc-macro-temporaire-local" class="nav-link" data-scroll-target="#macro-temporaire-local"><span class="toc-section-number">1.1</span>  <strong>Macro temporaire: local</strong></a></li>
  <li><a href="#macro-en-dur-global" id="toc-macro-en-dur-global" class="nav-link" data-scroll-target="#macro-en-dur-global"><span class="toc-section-number">1.2</span>  <strong>Macro en dur: global</strong></a></li>
  <li><a href="#la-commande-levelsof" id="toc-la-commande-levelsof" class="nav-link" data-scroll-target="#la-commande-levelsof"><span class="toc-section-number">1.3</span>  <strong>La commande levelsof</strong></a></li>
  <li><a href="#quelques-fonctions-associées-à-une-macro" id="toc-quelques-fonctions-associées-à-une-macro" class="nav-link" data-scroll-target="#quelques-fonctions-associées-à-une-macro"><span class="toc-section-number">1.4</span>  <strong>Quelques fonctions associées à une macro</strong></a>
  <ul class="collapse">
  <li><a href="#word-count" id="toc-word-count" class="nav-link" data-scroll-target="#word-count"><span class="toc-section-number">1.4.1</span>  word count</a></li>
  <li><a href="#value-label" id="toc-value-label" class="nav-link" data-scroll-target="#value-label"><span class="toc-section-number">1.4.2</span>  value label</a></li>
  <li><a href="#label" id="toc-label" class="nav-link" data-scroll-target="#label"><span class="toc-section-number">1.4.3</span>  label</a></li>
  <li><a href="#variable-label" id="toc-variable-label" class="nav-link" data-scroll-target="#variable-label"><span class="toc-section-number">1.4.4</span>  Variable label</a></li>
  </ul></li>
  <li><a href="#return-et-ereturn" id="toc-return-et-ereturn" class="nav-link" data-scroll-target="#return-et-ereturn"><span class="toc-section-number">1.5</span>  <strong>return et ereturn</strong></a></li>
  <li><a href="#compteurs-i" id="toc-compteurs-i" class="nav-link" data-scroll-target="#compteurs-i"><span class="toc-section-number">1.6</span>  <strong>Compteurs i++</strong></a></li>
  <li><a href="#autres-objets-macro-token-tempvar" id="toc-autres-objets-macro-token-tempvar" class="nav-link" data-scroll-target="#autres-objets-macro-token-tempvar"><span class="toc-section-number">1.7</span>  <strong>Autres objets macro: token, tempvar</strong></a>
  <ul class="collapse">
  <li><a href="#token" id="toc-token" class="nav-link" data-scroll-target="#token"><span class="toc-section-number">1.7.1</span>  <strong>Token</strong></a></li>
  <li><a href="#variables-temporaires" id="toc-variables-temporaires" class="nav-link" data-scroll-target="#variables-temporaires"><span class="toc-section-number">1.7.2</span>  <strong>Variables temporaires</strong></a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">Rappels sur les macros</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<p><br></p>
<section id="local---global" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> <strong>local - global</strong></h1>
<p>Les macros sont des objets qui enregistre une valeur ou une expression. On peut les utiliser une ou plusieurs fois dans un programme, et permettent de générer des blocs de programme en boucle.<br>
Leur utilisation est essentielle pour les graphiques Stata et faciliter leur réutilisation. Elles permettent entre autres:</p>
<ul>
<li>d’alléger la syntaxe de l’habillage.</li>
<li>de reporter automatiquement des valeurs (moyenne, minimum, maximum…) dans un graphique, générer automatiquement une légende ou une série de labels qui sera reporté sur un axe discret.</li>
<li>de produire des graphiques complexes, en particulier en générant des <strong>macros empilées</strong>.</li>
</ul>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Penser à tester/visualiser le contenu de la macro, avec <code>display</code> (<code>di</code>) ou <code>macro list</code> (<code>mac list</code>). - <code>mac list</code> renvoie la valeur ou l’expression qui a été réellement enregistré. <strong><em>A privilégier pour les macros qui renvoient une chaîne de caractère</em></strong>.<br>
- <code>display</code> (di) peut être privilégier pour visualiser ce qui sera affiché dans la fenêtre de l’output, ou pour les macros qui renvoient une valeur. à la fin de la session.</p>
</div>
</div>
<section id="macro-temporaire-local" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="macro-temporaire-local"><span class="header-section-number">1.1</span> <strong>Macro temporaire: local</strong></h2>
<p><br> Les macros de type temporaire (<strong><code>local</code></strong>) sont conservées en mémoire seulement le temps de l’exécution. Cependant en exécutant Stata avec <em><strong>Notebook Jupyter</strong> (librairie <code>Stata Kernel</code> – </em>Kyle barron*), ce type de macro vont rester en mémoire d’une exécution à une autre, ce qui peut présenter des avantages, en particulier pour les graphiques. Les macros seront effacées à la fin de la session. Voir la section dédiée à Python.</p>
<p><strong><em>Syntaxe</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nom [=] expression/opération</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nom [=] “expression”</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nom [=] <span class="ot">`““expression””'</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nom : fonction_macro           </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Appel de l’expression dans un programme</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">`nom'</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>“<span class="ot">`nom'</span>”</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Test/visualisation de l’expression</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _nom</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`nom'</span>  </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> “<span class="ot">`nom'</span>”</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p><strong><em>Exemple 1</em></strong>: on veut enregistrer le résultat de l’opération 1 + 1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span>  x  1 + 1</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _x</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>_x:  1 + 1</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`x'</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>mac list</code> ne renvoie pas le résultat de l’opération, alors qu’il a été bien généré. On doit utiliser l’opérateur d’affectation = .</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> x = 1 + 1</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _x</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>_x: 2</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`x'</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Exemple 2</em></strong>: on veut enregistrer l’expression ABC</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> x <span class="st">"ABC"</span> <span class="co">// ou</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> x ABC</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _x</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>_x: ABC</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`x'</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>ABC <span class="kw">not</span> found</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"`x'"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>ABC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Exemple 3</em></strong> : On veut enregistrer l’expression ABC avec les doubles quotes apparentes: “ABC”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> x <span class="st">"A"</span> <span class="st">"B"</span> <span class="st">"C"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _x</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>_x: A<span class="st">" "</span>B<span class="st">" "</span>C</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"`x'"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>ABC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La solution précédente ne fonctionne pas.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> x <span class="st">`""A"</span> <span class="st">"B"</span> <span class="st">"C""'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">mac list _x</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">_x: "</span>A<span class="st">" "</span>B<span class="st">" "</span>C<span class="st">"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">di "</span><span class="ot">`x'</span><span class="st">"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">A"</span> <span class="st">"B"</span> <span class="st">"C"</span> <span class="st">" invalid name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>di</code> renvoie de nouveau un message d’erreur alors que la macro est correctement assignée.</p>
<p><strong><em>Exemple 4</em></strong>: On alterne valeur numérique et du texte en conservant les doubles quotes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> no 0 <span class="st">"Non"</span> 1 <span class="st">"Oui"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _no</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>_no:     0 <span class="st">"Non"</span> 1 <span class="st">"Oui"</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"`no'"</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>0 Non<span class="st">" 1 "</span>Oui<span class="st">""</span> invalid <span class="bn">name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Remarque: de nouveau <code>di</code> renvoie un message d’erreur alors que la macro est correctement assignée.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> no 0 <span class="st">"Non"</span> 1 <span class="st">"Oui"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _no</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>_no:     0 <span class="st">"Non"</span> 1 <span class="st">"Oui"</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"`no'"</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>0 Non<span class="st">" 1 "</span>Oui<span class="st">""</span> invalid <span class="bn">name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="macro-en-dur-global" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="macro-en-dur-global"><span class="header-section-number">1.2</span> <strong>Macro en dur: global</strong></h2>
<p>Les macros de type <code>global</code> sont enregistrées en dur, et conservées en mémoire d’une exécution à une autre et d’une session à une autre. Elles sont appelées avec <strong><code>$</code></strong> et, avec <code>mac list</code>, le nom de la macro n’est pas précédé d’un underscore.</p>
<p><strong><em>Test/visualisation de l’expression</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> nom</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">$nom</span>  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"$nom"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="la-commande-levelsof" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="la-commande-levelsof"><span class="header-section-number">1.3</span> <strong>La commande levelsof</strong></h2>
<p>Cette commande particulièrement utile, pour ne pas dire incontournable, récupère les valeurs d’une variable et les enregistre dans une macro temporaire. <strong><code>levelsof</code></strong> précède régulièrement l’utilisation d’une boucle de type <code>foreach</code>.</p>
<p><strong>Syntaxe</strong>: <strong><code>levelsof nom_var [if/in], local(nom_macro)</code></strong></p>
<p><strong><em>Exemple</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="ot">list</span> origin</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>origin:</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>           0 Domestic</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>           1 Foreign</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> foreign, <span class="kw">local</span>(f)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _f</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>_f: 0 1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
glevelsof
</div>
</div>
<div class="callout-body-container callout-body">
<p>Pour des grosses volumétries (&gt;1M) il est conseillé d’utiliser la commande <strong><code>glevelsof</code></strong> de <em>M.Caceres</em> (package <code>glevelsof</code>):</p>
<ul>
<li><a href="https://gtools.readthedocs.io/en/latest/">gtools</a></li>
<li><a href="https://mthevenin.github.io/stata_programmation/speedup/gtools.html#glevelsof">glevelsof</a></li>
</ul>
</div>
</div>
</section>
<section id="quelques-fonctions-associées-à-une-macro" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="quelques-fonctions-associées-à-une-macro"><span class="header-section-number">1.4</span> <strong>Quelques fonctions associées à une macro</strong></h2>
<p>Il ne s’agit ici que de quelques fonctions utiles pour produire des graphiques et faciliter leur automatisation. L’ensemble des fonctions associées à une macro sont disponible dans l’aide (<code>help macro</code>).</p>
<p><br></p>
<section id="word-count" class="level3" data-number="1.4.1">
<h3 data-number="1.4.1" class="anchored" data-anchor-id="word-count"><span class="header-section-number">1.4.1</span> word count</h3>
<p>Permet de compter le nombre de termes contenus dans une expression enregistrée sous forme de macro. Utile pour compter le nombre de boucles à effectuer avec <code>forvalue</code>.</p>
<p><strong>Syntaxe</strong>: <strong><code>Local/global : word count(nom_macro)</code></strong></p>
<p><strong><em>Exemple</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> rep78, <span class="kw">local</span>(<span class="fu">r</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>1 2 3 4 5</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> nombre: <span class="fu">word</span> <span class="fu">count</span>(<span class="ot">`r'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _nombre</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>_nombre:  5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="value-label" class="level3" data-number="1.4.2">
<h3 data-number="1.4.2" class="anchored" data-anchor-id="value-label"><span class="header-section-number">1.4.2</span> value label</h3>
<p>Récupère le nom d’un label affecté aux modalités d’une variable. Le nom de la variable peut-être enregistré en amont sous forme de macro.</p>
<p><strong>Syntaxe</strong>: <strong><code>local/global nom_macro : value label nom_variable/nom_macro</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> varname foreign</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> labn : <span class="ot">value</span> <span class="kw">label</span> <span class="ot">`varname'</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _labn</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>_labn : origin</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
</section>
<section id="label" class="level3" data-number="1.4.3">
<h3 data-number="1.4.3" class="anchored" data-anchor-id="label"><span class="header-section-number">1.4.3</span> label</h3>
<p>Récupère l’expression de la modalité associée à une valeur d’un nom de label. Le nom du label peut avoir été enregistré en amont dans une macro (avec par exemple la fonction <code>value label</code>).</p>
<p><strong>Syntaxe</strong>: <strong><code>local/global nom_macro : label nom_label valeur</code></strong></p>
<p><strong><em>Exemple</em></strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lab0 : <span class="kw">label</span> origin 0</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lab1 : <span class="kw">label</span> origin 0</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _lab0</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>lab0 : Domestic</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _lab1</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>lab1 : Foreign</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En récupérant en amont le nom du label (origin).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> labn: <span class="ot">value</span> <span class="kw">label</span> foreign</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lab0: <span class="kw">label</span> <span class="ot">`labn'</span> 0</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lab1: <span class="kw">label</span> <span class="ot">`labn'</span> 1</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _lab0 _lab1</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>_lab0 : Domestic</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>_lab1 : Foreign</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En récupérant les valeurs de la variable avec levelsof, la modalité de chaque valeur peut-être récupérée dans une boucle <code>foreach</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> foreign, <span class="kw">local</span>(v)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> labn: <span class="ot">value</span> <span class="kw">label</span> foreign</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> val <span class="kw">of</span> <span class="kw">local</span> v {</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lab<span class="ot">`val'</span>: <span class="kw">label</span> <span class="ot">`labn'</span> <span class="ot">`val'</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _lab<span class="ot">`val'</span> </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>_lab0 : Domestic</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>_lab1 : Foreign</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>En mettant dès le début une macro sur le nom de la variable, on automatise les modifications. Il est même possible de mettre dans la macro plusieurs variables, et effectuer l’opération dans une boucle principale.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> X foreign</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> <span class="ot">`X'</span>, <span class="kw">local</span>(v)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> labn: <span class="ot">value</span> <span class="kw">label</span> <span class="ot">`X'</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> val <span class="kw">of</span> <span class="kw">local</span> v {</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lab<span class="ot">`val'</span>: <span class="kw">label</span> <span class="ot">`labn'</span> <span class="ot">`val'</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _lab<span class="ot">`val'</span> </span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>_lab0 : Domestic</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>_lab1 : Foreign</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Graphique</em></strong></p>
<p>On va récupérer automatiquement les modalités d’une variable pour renseigner la légende.</p>
<ul>
<li>La variable rep78 est regroupée en 2 modalités.</li>
<li>Les modalités de la légende sont automatiquement insérées dans l’expression <code>legend(order(…)...)</code>.</li>
<li>Pour utiliser une autre variable que rep, il suffit de modifier le nom de la variable dans la première macro (X).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> rep= rep78&lt;4</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="kw">define</span> rep 0 <span class="st">"rep&lt;4"</span> 1 <span class="st">"rep&gt;=4"</span>, modify</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">label</span> <span class="ot">value</span> rep rep</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>*Récupération <span class="kw">des</span> modalités</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> X rep</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> labn: <span class="ot">value</span> <span class="kw">label</span> <span class="ot">`X'</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> <span class="ot">`X'</span>, <span class="kw">local</span>(<span class="ot">l</span>)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> l2 <span class="kw">of</span> <span class="kw">local</span> <span class="ot">l</span> {</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lab<span class="ot">`l2'</span>: <span class="kw">label</span> <span class="ot">`labn'</span> <span class="ot">`l2'</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>*Graphique</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>#delimit ;</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="kw">tw</span> <span class="kw">scatter</span> price mpg <span class="kw">if</span> <span class="ot">`X'</span>, </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>   mc(<span class="st">"237 248 177"</span>)   mlc(<span class="bn">black</span>) mlw(*.3)  msiz(*1.5) jitter(2)     </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>|| <span class="kw">scatter</span> price mpg <span class="kw">if</span> !<span class="ot">`X'</span>, </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>   mc(<span class="st">"65 182 196"</span>)    mlc(<span class="bn">black</span>) mlw(*.3) msiz(*1.5) jitter(2)  </span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>|| , <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"`lab0'"</span> 2 <span class="st">"`lab1'"</span>) pos(11) region(<span class="kw">color</span>(%0)))         </span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>     <span class="bn">title</span>(<span class="st">"Variable `X'"</span>) </span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>#delimit <span class="kw">cr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Macro: Légende automatique (a)</figcaption><p></p>
<p><img src="imgp2/g1a.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
<p>Il suffit de modifier la première ligne qui enregistre le nom de la variable pour faire le même graphique avec la variable <em>foreign</em>: local X foreign.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Macro: Légende automatique (b)</figcaption><p></p>
<p><img src="imgp2/g1b.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</section>
<section id="variable-label" class="level3" data-number="1.4.4">
<h3 data-number="1.4.4" class="anchored" data-anchor-id="variable-label"><span class="header-section-number">1.4.4</span> Variable label</h3>
<p>Récupère le label d’une variable sous forme du macro. Utile pour gérer une modification du titre des axes passer par les lignes de programme d’un graphique, et plus généralement pour donner de l’information sur variable de type continu ou de comptage sans label affecté au valeurs.</p>
<p><strong>Syntaxe</strong>: <strong><code>local/global nom_macro : variable label variable/macro</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> labv:  <span class="kw">variable</span> <span class="kw">label</span> foreign</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _labv</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>_labv : car <span class="dv">type</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Modification du format d’une valeur numérique</em></strong> (changement du nombre de décimale)<br>
Dans la section suivante, on va utiliser utiliser des objets de type macro qui sont générés après avoir exécuté une commande. Lorsque ces objets sont des valeurs statistiques comme des moyennes, estimateurs de regression etc., leur format enregistré comporte généralement un nombre important de décimales. Il est possible de modifier/réduire ce nombre de décimales avec la fonction <code>di</code>.</p>
<p><strong>Syntaxe</strong>: <strong><code>local/global nom_macro : di format valeur/macro</code></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> dec: <span class="kw">di</span> %6.2f 0.123456789</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`dec'</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>.12</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="return-et-ereturn" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="return-et-ereturn"><span class="header-section-number">1.5</span> <strong>return et ereturn</strong></h2>
<p>Après l’exécution d’une commande, un certain nombre d’objets sont conservés en mémoire jusqu’à l’exécution de la commande suivante. Leur liste est indiquée en bas du fichier d’aide.</p>
<ul>
<li><p>objets return: <code>r(nom_objet)</code></p></li>
<li><p>Affichage de la liste: <code>return list</code></p></li>
<li><p>objets ereturn: <code>e(nom_objet)</code></p></li>
<li><p>Affichage liste: <code>ereturn list</code></p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> price, <span class="kw">d</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">                            Price</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">-------------------------------------------------------------</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">      Percentiles      Smallest</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"> 1%         3291           3291</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"> 5%         3748           3299</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">10%         3895           3667       Obs                  74</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">25%         4195           3748       Sum of Wgt.          74</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">50%       5006.5                      Mean           6165.257</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">                        Largest       Std. Dev.      2949.496</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">75%         6342          13466</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">90%        11385          13594       Variance        8699526</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">95%        13466          14500       Skewness       1.653434</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">99%        15906          15906       Kurtosis       4.819188</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">return list</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">scalars:</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">                  r(N) =  74</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">              r(sum_w) =  74</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co">               r(mean) =  6165.256756756757</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co">                r(Var) =  8699525.97426879</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co">                 r(sd) =  2949.495884768919</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">           r(skewness) =  1.653433511704859</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co">           r(kurtosis) =  4.819187528464004</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co">                r(sum) =  456229</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co">                r(min) =  3291</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co">                r(max) =  15906</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="co">                 r(p1) =  3291</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="co">                 r(p5) =  3748</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a><span class="co">                r(p10) =  3895</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="co">                r(p25) =  4195</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="co">                r(p50) =  5006.5</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a><span class="co">                r(p75) =  6342</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="co">                r(p90) =  11385</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a><span class="co">                r(p95) =  13466</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a><span class="co">                r(p99) =  15906</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span>, <span class="kw">d</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>.54054054</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`r(mean)'</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>.54054054</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">mean</span> <span class="fu">r</span>(<span class="kw">mean</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`mean'</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>.54054054</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _mean</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>.5405405405405406</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">mean</span> : <span class="kw">di</span> %6.2f <span class="ot">`r(mean)'</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="ot">`mean'</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>0.54</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>mac <span class="ot">list</span> _mean</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>_mean : 0.54</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Au niveau d’un graphique ces objets permettent:</p>
<ul>
<li>D’afficher des valeurs dans un graphique.</li>
<li>De générer automatiquement des éléments de type <code>xline</code> <code>yline</code>.</li>
<li>De générer des graphiques de type scatteri ou pci qui entrent directement les coordonnées au lieu des variables.</li>
</ul>
<p><strong><em>Graphique</em></strong></p>
<p>On va tracer une droite sur chaque axe qui reporte les moyennes des variables price et mpg, les valeurs de ces moyennes sont reportés en bas du graphique en tant que note</p>
<ul>
<li>Récupération des moyennes de <em>price</em> et <em>mpg</em></li>
<li>les noms des macros seront <em>mprice</em> et * mpg*</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">varlist</span> price mpg</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">local</span> <span class="kw">varlist</span> {</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> <span class="ot">`v'</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span>  m<span class="ot">`v'</span> : <span class="kw">di</span> %6.2f <span class="ot">`r(mean)'</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>* Récupération <span class="kw">des</span> labels <span class="kw">de</span> la <span class="kw">variable</span> foreign</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> X foreign</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> labn: <span class="ot">value</span> <span class="kw">label</span> <span class="ot">`X'</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> <span class="ot">`X'</span>, <span class="kw">local</span>(<span class="ot">l</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> l2 <span class="kw">of</span> <span class="kw">local</span> <span class="ot">l</span> {</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> lab<span class="ot">`l2'</span>: <span class="kw">label</span> <span class="ot">`labn'</span>  <span class="ot">`l2'</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>* Graphique</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>#delimit ; </span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="kw">tw</span> <span class="kw">scatter</span> price mpg <span class="kw">if</span> !foreign, </span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>   mlc(<span class="bn">black</span>) mlw(*.3) mc(<span class="st">"254 196 79"</span>) msiz(*1.5)  jitter(2) </span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>|| <span class="kw">scatter</span> price mpg <span class="kw">if</span> foreign,</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>   mlc(<span class="bn">black</span>) mlw(*.3) mc(<span class="st">"153 52 4"</span>)   msiz(*1.5)  jitter(2) </span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>|| , <span class="bn">legend</span>(<span class="kw">order</span>(1 <span class="st">"`lab0'"</span> 2 <span class="st">"`lab1'"</span>) pos(11) region(<span class="kw">color</span>(%0))) </span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>     <span class="kw">yline</span>(<span class="ot">`mprice'</span>, lc(<span class="st">"236 112 20"</span>) lw(*1.5)) </span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>     <span class="bn">xline</span>(<span class="ot">`mmpg'</span>  , lc(<span class="st">"236 112 20"</span>) lw(*1.5))</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>     <span class="kw">note</span>(<span class="st">"{bf:Moyenne Price = `mprice'}"</span> </span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"{bf:Moyenne Mpg   = `mmpg'}"</span>)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>;</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>#delimit <span class="kw">cr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">xline - yline: récupération des valeurs dans une macro</figcaption><p></p>
<p><img src="imgp2/g2.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
</section>
<section id="compteurs-i" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="compteurs-i"><span class="header-section-number">1.6</span> <strong>Compteurs i++</strong></h2>
<p>Les compteurs vont s’avérer très utiles dans les expressions en boucle pour générer une valeur incrémentale de type macro. C’est sur ce principe que fonctionne les boucles de type <code>forvalue</code>, mais il est possible de les générer dans une boucle de type <code>foreach</code>.</p>
<p><strong><em>Exemple1</em></strong>: on initialise un compteur <code>i</code>. Dans une boucle <code>forvalue</code> dont l’incrément va de 10 à 15 (<span class="math inline">\(\delta=+1\)</span>), on génère à chaque boucle une valeur allant de 1 à 6 avec la macro `<code>i++'</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i = 1</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>forvalue <span class="kw">k</span> = 10/15 {</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"k=`k' =&gt; i=`i++'"</span>   </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">k=10 =&gt; i=1</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">k=11 =&gt; i=2</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">k=12 =&gt; i=3</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">k=13 =&gt; i=4</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">k=14 =&gt; i=5</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">k=15 =&gt; i=6</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Exemple 2</em></strong>: on va afficher les noms d’une liste de variable en noms génériques dans une boucle <code>foreach</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i=1</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">varlist</span> price mpg turn <span class="fu">length</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">local</span> <span class="kw">varlist</span>  {</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"variable`i++' = `v'"</span>        </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">variable1 = price</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">variable2 = mpg</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">variable3 = turn</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">variable4 = length</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> <strong>Point de vigilance</strong></p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Appels multiples d’un compteur dans une boucle. Dans les exemples précédents, le compteur n’a été utilisé qu’une fois dans une itération. Il est important de noter que le compteur peut continuer à incrémenter lorsqu’il est appelé plusieurs fois dans une itération. Nous allons présenter les différents comportements du compteur, et le moyen de fixer sa valeur dans une itération avec des appels multiples.</p>
</div>
</div>
<p><strong><em>Situation1</em></strong>: Un seul appel du compteur (cas standard)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>forv i=1/5 {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">di</span> <span class="st">"iteration `i': i++ ="</span>  <span class="ot">`i++'</span> </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 1: i++ =1</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 2: i++ =2</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 3: i++ =3</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 4: i++ =4</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 5: i++ =5</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Situation2</em></strong>: Plusieurs appels dans une itération dans une boucle standard : la valeur du compteur est fixe dans chaque itération, mais pour la première et la dernière, le second appel est ignoré.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>forv i=1/5 {</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"iteration `i': i++ ="</span>  <span class="ot">`i++'</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="kw">di</span> <span class="st">"iteration `i': i++ ="</span>  <span class="ot">`i++'</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 1: i++ =1</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 2: i++ =2</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 2: i++ =2</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 3: i++ =3</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 3: i++ =3</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 4: i++ =4</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 4: i++ =4</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 5: i++ =5</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 5: i++ =5</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 6: i++ =6</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Situation3</em></strong>: On initialise le compteur en amont (<strong>k</strong>*), il continue d’incrémenter dans chaque itération.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">k</span>=1</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>forv i=1/5 {</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">di</span> <span class="st">"iteration `i': "</span>  <span class="ot">`k++'</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">di</span> <span class="st">"iteration `i': "</span>  <span class="ot">`k++'</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 1: 1</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 1: 2</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 2: 3</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 2: 4</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 3: 5</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 3: 6</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 4: 7</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 4: 8</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 5: 9</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 5: 10</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Situation4</em></strong>: le compteur est appelé plusieurs fois. On veut fixer sa valeur pour qu’elle soit égale à la valeur de l’itération, sans rencontrer le problème de la situation2 avec un appel simple à la première et dernière itération. On va devoir initialiser un nouveau compteur à l’intérieur de la boucle, à chaque itération (compteur <strong><em>j</em></strong>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">k</span>=1</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>forv i=1/5 {</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">local</span> j = <span class="ot">`k++'</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a> <span class="kw">di</span> <span class="st">"iteration `i': "</span>  <span class="ot">`j'</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a> <span class="kw">di</span> <span class="st">"iteration `i': "</span>  <span class="ot">`j'</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 1: 1</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 1: 1</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 2: 2</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 2: 2</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 3: 3</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 3: 3</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 4: 4</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 4: 4</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 5: 5</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co">iteration 5: 5</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si le compteur est utilisé plusieurs dans une itération et que sa valeur y doit être fixe, on devra donc utiliser cette dernière expression.</p>
<p><strong>Graphique</strong></p>
<p>Le graphique suivant donne la distribution de la variable displacement selon le nombre de réparation (variable <strong>rep78</strong>). Pour chaque valeur de <strong><em>rep78</em></strong>, la moyenne de displacement est reportée. Ces moyennes sont connectées à la moyenne calculée sur l’ensemble des voitures. On retrouve le principe d’un graphique de type « <strong>lollipop</strong> ».</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i=1</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> rep78, <span class="kw">local</span>(<span class="ot">l</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">local</span> <span class="ot">l</span> {</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> displacement  <span class="kw">if</span> rep78==<span class="ot">`v'</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> m<span class="ot">`i++'</span> = <span class="ot">`r(mean)'</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> displacement </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">mean</span> <span class="ot">`r(mean)'</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>#delimit ;</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a><span class="kw">tw</span>  scatteri 2 <span class="ot">`m1'</span>,  <span class="bn">msymbol</span>(|) mc(<span class="st">"210 50 0"</span>) msize(*5) mlw(*3)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>||  scatteri 3 <span class="ot">`m2'</span>,  <span class="bn">msymbol</span>(|) mc(<span class="st">"210 50 0"</span>) msize(*5) mlw(*3)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>||  scatteri 4 <span class="ot">`m3'</span>,  <span class="bn">msymbol</span>(|) mc(<span class="st">"210 50 0"</span>) msize(*5) mlw(*3)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>||  scatteri 5 <span class="ot">`m4'</span>,  <span class="bn">msymbol</span>(|) mc(<span class="st">"210 50 0"</span>) msize(*5) mlw(*3)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>|| pci 2 <span class="ot">`mean'</span> 5 <span class="ot">`mean'</span>, lw(*2.5) lc(<span class="st">"210 50 0"</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>|| pci 2 <span class="ot">`mean'</span> 2 <span class="ot">`m1'</span>  , lw(*2.5) lc(<span class="st">"210 50 0"</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>|| pci 3 <span class="ot">`mean'</span> 3 <span class="ot">`m2'</span>  , lw(*2.5) lc(<span class="st">"210 50 0"</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>|| pci 4 <span class="ot">`mean'</span> 4 <span class="ot">`m3'</span>  , lw(*2.5) lc(<span class="st">"210 50 0"</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>|| pci 5 <span class="ot">`mean'</span> 5 <span class="ot">`m4'</span>  , lw(*2.5) lc(<span class="st">"255 50 0"</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>||  <span class="kw">scatter</span> rep78 displacement,  mc(<span class="st">"255 117 0%70"</span>) mlc(210 50 0) mlw(*.5) msize(*1) jitter(5) || , </span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="kw">xlabel</span>(,glw(*1.2)) <span class="kw">ylabel</span>(,glw(*.5) angle(0)) <span class="bn">yscale</span>(<span class="kw">range</span>(1.8, 5.2))</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="bn">legend</span>(<span class="kw">off</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="bn">title</span>(<span class="st">"Averages of displacement"</span>) <span class="bn">ytitle</span>(<span class="st">"Number of repairs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Graphique avec compteur et objet de type <code>r()</code></figcaption><p></p>
<p><img src="imgp2/g3.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>
<p><strong><em>Pas à pas du programme</em></strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">recode</span> rep78 (1=2)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> i=1</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="kw">levelsof</span> rep78, <span class="kw">local</span>(<span class="ot">l</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> v <span class="kw">of</span> <span class="kw">local</span> <span class="ot">l</span> {</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> displacement  <span class="kw">if</span> rep78==<span class="ot">`v'</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> m<span class="ot">`i++'</span> = <span class="ot">`r(mean)'</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> displacement </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">mean</span> <span class="ot">`r(mean)'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>On regroupe les deux premières valeurs de <strong><em>rep78</em></strong> (peu d’observations).</li>
<li>On initialise le compteur qui sera utilisé dans une boucle <code>foreach</code>.</li>
<li>On récupère les valeurs de la variable <strong><em>rep78</em></strong> avec <code>levelsof</code>.</li>
<li>Dans la boucle on récupère les valeurs des moyennes de <strong><em>displacement</em></strong> pour chaque valeur de <code>rep78</code>. Elles sont enregistrées dans les expressions macro <strong><em>m1</em></strong> à <strong><em>m4</em></strong>. Les valeurs 1 à 4 sont générées par le compteur <code>i++</code>.</li>
<li>On récupère la moyenne pour l’ensemble des voitures. Elle est enregistrée dans la macro <strong><em>mean</em></strong>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>#delimit ;</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">tw</span>  scatteri 2 <span class="ot">`m1'</span>,  <span class="bn">msymbol</span>(|) mc(<span class="st">"210 50 0"</span>) msize(*5) mlw(*3)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>||  scatteri 3 <span class="ot">`m2'</span>,  <span class="bn">msymbol</span>(|) mc(<span class="st">"210 50 0"</span>) msize(*5) mlw(*3)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>||  scatteri 4 <span class="ot">`m3'</span>,  <span class="bn">msymbol</span>(|) mc(<span class="st">"210 50 0"</span>) msize(*5) mlw(*3)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>||  scatteri 5 <span class="ot">`m4'</span>,  <span class="bn">msymbol</span>(|) mc(<span class="st">"210 50 0"</span>) msize(*5) mlw(*3)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>|| pci 2 <span class="ot">`mean'</span> 5 <span class="ot">`mean'</span>, lw(*2.5) lc(<span class="st">"210 50 0"</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>|| pci 2 <span class="ot">`mean'</span> 2 <span class="ot">`m1'</span>  , lw(*2.5) lc(<span class="st">"210 50 0"</span>)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>|| pci 3 <span class="ot">`mean'</span> 3 <span class="ot">`m2'</span>  , lw(*2.5) lc(<span class="st">"210 50 0"</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>|| pci 4 <span class="ot">`mean'</span> 4 <span class="ot">`m3'</span>  , lw(*2.5) lc(<span class="st">"210 50 0"</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>|| pci 5 <span class="ot">`mean'</span> 5 <span class="ot">`m4'</span>  , lw(*2.5) lc(<span class="st">"255 50 0"</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>|| <span class="kw">scatter</span> rep78 displacement, mc(<span class="st">"255 117 0%70"</span>) mlc(210 50 0) mlw(*.5)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>   msize(*1) jitter(5)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>|| , <span class="kw">xlabel</span>(,glw(*1.2)) <span class="kw">ylabel</span>(,glw(*.5) angle(0)) <span class="bn">yscale</span>(<span class="kw">range</span>(1.8, 5.2))</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>     <span class="bn">legend</span>(<span class="kw">off</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>     <span class="bn">title</span>(<span class="st">"Averages of displacement"</span>) <span class="bn">ytitle</span>(<span class="st">"Number of repairs"</span>);</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>#delimit <span class="kw">cr</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Pour faciliter l’écriture et la lecture du programme on change de type de délimiteur.</li>
<li>Les moyennes par niveau de réparation seront en arrière plan pour visualiser les valeurs de toutes les voitures.</li>
<li>On utilise <strong><em><code>scatteri</code></em></strong> pour générer le nuage des moyennes pour chaque niveau de réparation. Les valeurs de ces dernières sont connues (de 2 à 5) et les moyennes de displacement on été enregistrées dans les macros m1 à m4. Pour le premier niveau de réparation le nuage est donc généré par **scatteri 2 <code>m1'** [</code>scatteri valeur_Y valeur_X<code>]. On a utilisé un symbole de type ***pipe*** au lieu d’une bulle [</code>msymbol(|)`].</li>
<li>On trace une droite verticale avec la fonction <code>pci</code> pour indiquer la moyenne de displacement pour l’ensemble des voitures. La valeur de cette moyenne (X) a été calculée en amont (macro <strong><em>mean</em></strong>) et on connait les valeurs de Y. La droite est donc générée par pci 2 <code>mean' 5</code>mean’ [<code>pci min_Y min_X max_Y max_X</code>].</li>
<li>On va connecter la valeur des moyennes pour chaque niveau de réparation avec la moyenne d’ensemble. On va ici tracer des droites horizontale, dont les coordonnées Y seront cette fois ci fixe, et le minimum de X toujours égal à la moyenne d’ensemble. Pour le premier niveau de réparation : <strong>pci 2 <code>mean' 2</code>m1’</strong>.</li>
</ul>
<p><strong><em>Remarque</em></strong>: on pourrait améliorer le rendu de l’angle pour la connection des moyennes en modifiant légèrement les valeurs de Y_min et Y_max pour la droite verticale, avec par exemple : <strong><em>pci 1.985 <code>mean' 5.015</code>mean’, lw(</em>2.5) lc(“210 50 0”)</strong>*.</p>
</section>
<section id="autres-objets-macro-token-tempvar" class="level2" data-number="1.7">
<h2 data-number="1.7" class="anchored" data-anchor-id="autres-objets-macro-token-tempvar"><span class="header-section-number">1.7</span> <strong>Autres objets macro: token, tempvar</strong></h2>
<section id="token" class="level3" data-number="1.7.1">
<h3 data-number="1.7.1" class="anchored" data-anchor-id="token"><span class="header-section-number">1.7.1</span> <strong>Token</strong></h3>
<p>Les tokens sont régulièrement utilisés dans la programmation de routines (<strong><em>.ado</em></strong>), mais peuvent dans un programme courant s’avérer utile pour transformer les noms variables en macros. Le token est une macro qui prend comme expression une liste de numéros : <code>1',</code>2’, <code>3'…… On transforme une expression en token avec la commande **</code>tokenize`**.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> price mpg</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> <span class="ot">`1'</span> <span class="ot">`2'</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Variable |        Obs        Mean    Std. Dev.       Min        Max</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">-------------+---------------------------------------------------------</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">       price |         74    6165.257    2949.496       3291      15906</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">         mpg |         74     21.2973    5.785503         12         41</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Ou avec une expression sous forme de macro:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">varlist</span> price mpg</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`varlist'</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> <span class="ot">`1'</span> <span class="ot">`2'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Application pour un graphique:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">varlist</span> price mpg foreign </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`varlist'</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">tw</span> <span class="kw">scatter</span> <span class="ot">`1'</span> <span class="ot">`2'</span> <span class="kw">if</span> !<span class="ot">`3'</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>|| <span class="kw">scatter</span> <span class="ot">`1'</span> <span class="ot">`2'</span> <span class="kw">if</span>  <span class="ot">`3'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="variables-temporaires" class="level3" data-number="1.7.2">
<h3 data-number="1.7.2" class="anchored" data-anchor-id="variables-temporaires"><span class="header-section-number">1.7.2</span> <strong>Variables temporaires</strong></h3>
<p>Variables, fichiers… peuvent être créés de manière temporaire. On regardera seulement les variables temporaires générées avec la fonction <strong><code>tempvar nom_variable</code></strong>, elles sont appelées sous forme de macro temporaire : <code>command</code>nom_variable’`. Principalement, elles permettent de générer des variables dont le nom n’entre pas en conflit avec des variables existantes, le nom enregistré étant de la forme** _00000#**, tout en n’alourdissanrpas artificiellement le contenu de la base.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 100</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>number <span class="kw">of</span> observations (_N) was 0, now 100</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> x</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="ot">`x'</span> = runiform() </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="kw">des</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">----------------------------------------------------------------------------------</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">              storage   display    value</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co">variable name   type    format     label      variable label</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co">----------------------------------------------------------------------------------</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co">__000000        float   %9.0g </span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co">----------------------------------------------------------------------------------       </span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> <span class="ot">`x'</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Variable |        Obs        Mean    Std. Dev.       Min        Max</span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co">-------------+---------------------------------------------------------</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co">    __000000 |        100    .5253147    .2740814   .0073346   .9979447</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> x</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="ot">`x'</span> = runiform()</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="kw">des</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a><span class="co">----------------------------------------------------------------------------------</span></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co">              storage   display    value</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a><span class="co">variable name   type    format     label      variable label</span></span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a><span class="co">----------------------------------------------------------------------------------</span></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="co">__000000        float   %9.0g                 </span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="co">__000001        float   %9.0g                 </span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="co">----------------------------------------------------------------------------------</span></span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a><span class="co">sum `x'</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a><span class="co">    Variable |        Obs        Mean    Std. Dev.       Min        Max</span></span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a><span class="co">-------------+---------------------------------------------------------</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a><span class="co">    __000001 |        100     .471744    .2926945   .0028599   .9711645</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><em>Graphique</em></strong></p>
<p>On va de nouveau représenter un nuage de points, entre la variable <strong><em>price</em></strong> et la variable <strong><em>displacement</em></strong>. La couleur des bulles représente l’appartenance à un quartile de la variable displacement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sysuse</span> auto, <span class="kw">clear</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">tempvar</span> qdisp</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> <span class="kw">varlist</span> price displacement <span class="ot">`qdisp'</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tokenize</span> <span class="ot">`varlist'</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">xtile</span> <span class="ot">`qdisp'</span> = <span class="ot">`2'</span>, n(4)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span> <span class="kw">sum</span> <span class="ot">`2'</span>, <span class="kw">d</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>#delimit ;</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="kw">tw</span> <span class="kw">scatter</span> <span class="ot">`1'</span> <span class="ot">`2'</span> <span class="kw">if</span> <span class="ot">`3'</span>==1,</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>   mlc(<span class="bn">black</span>) mlw(*.5) mc(<span class="st">"68 1 84%60"</span>)    msiz(*1.5) jitter(1)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>|| <span class="kw">scatter</span> <span class="ot">`1'</span> <span class="ot">`2'</span> <span class="kw">if</span> <span class="ot">`3'</span>==2,</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>   mlc(<span class="bn">black</span>) mlw(*.5) mc(<span class="st">"49 104 142%60"</span>) msiz(*1.5) jitter(1)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>|| <span class="kw">scatter</span> <span class="ot">`1'</span> <span class="ot">`2'</span> <span class="kw">if</span> <span class="ot">`3'</span>==4,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>   mlc(<span class="bn">black</span>) mlw(*.5) mc(<span class="st">"53 183 121%60"</span>) msiz(*1.5) jitter(1)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>|| <span class="kw">scatter</span> <span class="ot">`1'</span> <span class="ot">`2'</span> <span class="kw">if</span> <span class="ot">`3'</span>==3,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>   mlc(<span class="bn">black</span>) mlw(*.5) mc(<span class="st">"253 231 37%60"</span>) msiz(*1.5) jitter(1)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>||, <span class="bn">legend</span>(<span class="kw">off</span>) </span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">xlabel</span>(<span class="ot">`r(p25)'</span> <span class="st">"`r(p25)'"</span> <span class="ot">`r(p50)'</span> <span class="st">"`r(p50)'"</span> <span class="ot">`r(p75)'</span> <span class="st">"`r(p75)'"</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p></p><figcaption class="figure-caption">Utilisation des tokens et des variables temporaires</figcaption><p></p>
<p><img src="imgp2/g4.png" class="img-fluid figure-img" style="width:60.0%"></p>
</figure>
</div>


<!-- -->

</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../formation/formation14.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Combiner des graphiques</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../formation/formation22.html" class="pagination-link">
        <span class="nav-page-text">Alleger la syntaxe</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb39" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Rappels sur les macros"</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="an">fig-cap-location:</span><span class="co"> top</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Statamarkdown)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>stataexe <span class="ot">&lt;-</span> <span class="st">"C:/Program Files/Stata17/StataSE-64.exe"</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">engine.path=</span><span class="fu">list</span>(<span class="at">stata=</span>stataexe))</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="fu"># **local - global**</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>Les macros sont des objets qui enregistre une valeur ou une expression. On peut les utiliser une ou plusieurs fois dans un programme, et permettent de générer des blocs de programme en boucle.   </span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>Leur utilisation est essentielle pour les graphiques Stata et faciliter leur réutilisation. Elles permettent entre autres:  </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>d’alléger la syntaxe de l’habillage.</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>de reporter automatiquement des valeurs (moyenne, minimum, maximum…) dans un graphique, générer automatiquement une légende ou une série de labels qui sera reporté sur un axe discret. </span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>de produire des graphiques complexes, en particulier en générant des **macros empilées**.</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>Penser à tester/visualiser le contenu de la macro, avec <span class="in">`display`</span> (<span class="in">`di`</span>) ou <span class="in">`macro list`</span> (<span class="in">`mac list`</span>). </span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`mac list`</span> renvoie la valeur ou l’expression  qui a été réellement enregistré. ***A privilégier pour les macros qui renvoient une chaîne de caractère***.  </span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`display`</span> (di) peut être privilégier pour visualiser ce qui sera affiché dans la fenêtre de l’output, ou pour les macros qui renvoient une valeur. </span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>à la fin de la session.</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Macro temporaire: local**    </span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>Les macros de type temporaire (**`local`**) sont conservées en mémoire seulement le temps de l’exécution. </span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>Cependant en exécutant Stata avec ***Notebook Jupyter** (librairie <span class="in">`Stata Kernel`</span> – *Kyle barron*), ce type de macro vont rester en mémoire d’une exécution à une autre, ce qui peut présenter des avantages, en particulier pour les graphiques. Les macros seront effacées à la fin de la session. Voir la section dédiée à Python. </span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>***Syntaxe***</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="in">local nom [=] expression/opération</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="in">local nom [=] “expression”</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="in">local nom [=] `““expression””' </span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a><span class="in">local nom : fonction_macro           </span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>***Appel de l’expression dans un programme***</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a><span class="in">`nom' </span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a><span class="in">“`nom'”</span></span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>***Test/visualisation de l’expression***</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _nom</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a><span class="in">di `nom'  </span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a><span class="in">di “`nom'”</span></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>***Exemple 1***: on veut enregistrer le résultat de l'opération 1 + 1</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a><span class="in">local  x  1 + 1</span></span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _x</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a><span class="in">_x:  1 + 1</span></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a><span class="in">di `x'</span></span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a><span class="in">2</span></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a><span class="in">`mac list`</span> ne renvoie pas le résultat de l’opération, alors qu’il a été bien généré. On doit utiliser l’opérateur d’affectation = .   </span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-86"><a href="#cb39-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-87"><a href="#cb39-87" aria-hidden="true" tabindex="-1"></a><span class="in">local x = 1 + 1</span></span>
<span id="cb39-88"><a href="#cb39-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-89"><a href="#cb39-89" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _x</span></span>
<span id="cb39-90"><a href="#cb39-90" aria-hidden="true" tabindex="-1"></a><span class="in">_x: 2</span></span>
<span id="cb39-91"><a href="#cb39-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-92"><a href="#cb39-92" aria-hidden="true" tabindex="-1"></a><span class="in">di `x'</span></span>
<span id="cb39-93"><a href="#cb39-93" aria-hidden="true" tabindex="-1"></a><span class="in">2</span></span>
<span id="cb39-94"><a href="#cb39-94" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-95"><a href="#cb39-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-96"><a href="#cb39-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-97"><a href="#cb39-97" aria-hidden="true" tabindex="-1"></a>***Exemple 2***: on veut enregistrer l'expression ABC  </span>
<span id="cb39-98"><a href="#cb39-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-99"><a href="#cb39-99" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-100"><a href="#cb39-100" aria-hidden="true" tabindex="-1"></a><span class="in">local x "ABC" // ou</span></span>
<span id="cb39-101"><a href="#cb39-101" aria-hidden="true" tabindex="-1"></a><span class="in">local x ABC</span></span>
<span id="cb39-102"><a href="#cb39-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-103"><a href="#cb39-103" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _x</span></span>
<span id="cb39-104"><a href="#cb39-104" aria-hidden="true" tabindex="-1"></a><span class="in">_x: ABC</span></span>
<span id="cb39-105"><a href="#cb39-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-106"><a href="#cb39-106" aria-hidden="true" tabindex="-1"></a><span class="in">di `x'</span></span>
<span id="cb39-107"><a href="#cb39-107" aria-hidden="true" tabindex="-1"></a><span class="in">ABC not found</span></span>
<span id="cb39-108"><a href="#cb39-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-109"><a href="#cb39-109" aria-hidden="true" tabindex="-1"></a><span class="in">di "`x'"</span></span>
<span id="cb39-110"><a href="#cb39-110" aria-hidden="true" tabindex="-1"></a><span class="in">ABC</span></span>
<span id="cb39-111"><a href="#cb39-111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-112"><a href="#cb39-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-113"><a href="#cb39-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-114"><a href="#cb39-114" aria-hidden="true" tabindex="-1"></a>***Exemple 3*** :  On veut enregistrer l’expression ABC avec les doubles quotes apparentes: "ABC"  </span>
<span id="cb39-115"><a href="#cb39-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-116"><a href="#cb39-116" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-117"><a href="#cb39-117" aria-hidden="true" tabindex="-1"></a><span class="in">local x "A" "B" "C"</span></span>
<span id="cb39-118"><a href="#cb39-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-119"><a href="#cb39-119" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _x</span></span>
<span id="cb39-120"><a href="#cb39-120" aria-hidden="true" tabindex="-1"></a><span class="in">_x: A" "B" "C</span></span>
<span id="cb39-121"><a href="#cb39-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-122"><a href="#cb39-122" aria-hidden="true" tabindex="-1"></a><span class="in">di "`x'"</span></span>
<span id="cb39-123"><a href="#cb39-123" aria-hidden="true" tabindex="-1"></a><span class="in">ABC</span></span>
<span id="cb39-124"><a href="#cb39-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-125"><a href="#cb39-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-126"><a href="#cb39-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-127"><a href="#cb39-127" aria-hidden="true" tabindex="-1"></a>La solution précédente ne fonctionne pas.   </span>
<span id="cb39-128"><a href="#cb39-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-129"><a href="#cb39-129" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-130"><a href="#cb39-130" aria-hidden="true" tabindex="-1"></a><span class="in">local x `""A" "B" "C""'</span></span>
<span id="cb39-131"><a href="#cb39-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-132"><a href="#cb39-132" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _x</span></span>
<span id="cb39-133"><a href="#cb39-133" aria-hidden="true" tabindex="-1"></a><span class="in">_x: "A" "B" "C"</span></span>
<span id="cb39-134"><a href="#cb39-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-135"><a href="#cb39-135" aria-hidden="true" tabindex="-1"></a><span class="in">di "`x'"</span></span>
<span id="cb39-136"><a href="#cb39-136" aria-hidden="true" tabindex="-1"></a><span class="in">A" "B" "C" " invalid name</span></span>
<span id="cb39-137"><a href="#cb39-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-138"><a href="#cb39-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-139"><a href="#cb39-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-140"><a href="#cb39-140" aria-hidden="true" tabindex="-1"></a><span class="in">`di`</span> renvoie de nouveau un message d’erreur alors que la macro est correctement assignée.  </span>
<span id="cb39-141"><a href="#cb39-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-142"><a href="#cb39-142" aria-hidden="true" tabindex="-1"></a>***Exemple 4***: On alterne valeur numérique et du texte en conservant les doubles quotes.  </span>
<span id="cb39-143"><a href="#cb39-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-144"><a href="#cb39-144" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-145"><a href="#cb39-145" aria-hidden="true" tabindex="-1"></a><span class="in">local no 0 "Non" 1 "Oui"</span></span>
<span id="cb39-146"><a href="#cb39-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-147"><a href="#cb39-147" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _no</span></span>
<span id="cb39-148"><a href="#cb39-148" aria-hidden="true" tabindex="-1"></a><span class="in">_no:     0 "Non" 1 "Oui"</span></span>
<span id="cb39-149"><a href="#cb39-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-150"><a href="#cb39-150" aria-hidden="true" tabindex="-1"></a><span class="in">di "`no'"</span></span>
<span id="cb39-151"><a href="#cb39-151" aria-hidden="true" tabindex="-1"></a><span class="in">0 Non" 1 "Oui"" invalid name</span></span>
<span id="cb39-152"><a href="#cb39-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-153"><a href="#cb39-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-154"><a href="#cb39-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-155"><a href="#cb39-155" aria-hidden="true" tabindex="-1"></a>Remarque: de nouveau <span class="in">`di`</span> renvoie un message d’erreur alors que la macro est correctement assignée. </span>
<span id="cb39-156"><a href="#cb39-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-157"><a href="#cb39-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-158"><a href="#cb39-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-159"><a href="#cb39-159" aria-hidden="true" tabindex="-1"></a><span class="in">local no 0 "Non" 1 "Oui"</span></span>
<span id="cb39-160"><a href="#cb39-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-161"><a href="#cb39-161" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _no</span></span>
<span id="cb39-162"><a href="#cb39-162" aria-hidden="true" tabindex="-1"></a><span class="in">_no:     0 "Non" 1 "Oui"</span></span>
<span id="cb39-163"><a href="#cb39-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-164"><a href="#cb39-164" aria-hidden="true" tabindex="-1"></a><span class="in">di "`no'"</span></span>
<span id="cb39-165"><a href="#cb39-165" aria-hidden="true" tabindex="-1"></a><span class="in">0 Non" 1 "Oui"" invalid name</span></span>
<span id="cb39-166"><a href="#cb39-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-167"><a href="#cb39-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-168"><a href="#cb39-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-169"><a href="#cb39-169" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Macro en dur: global**   </span></span>
<span id="cb39-170"><a href="#cb39-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-171"><a href="#cb39-171" aria-hidden="true" tabindex="-1"></a>Les macros de type <span class="in">`global`</span> sont enregistrées en dur, et conservées en mémoire d’une exécution à une autre et d’une session à une autre. Elles sont appelées avec **`$`** et, avec <span class="in">`mac list`</span>, le nom de la macro n’est pas précédé d’un underscore.   </span>
<span id="cb39-172"><a href="#cb39-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-173"><a href="#cb39-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-174"><a href="#cb39-174" aria-hidden="true" tabindex="-1"></a>***Test/visualisation de l’expression***</span>
<span id="cb39-175"><a href="#cb39-175" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-176"><a href="#cb39-176" aria-hidden="true" tabindex="-1"></a><span class="in">mac list nom</span></span>
<span id="cb39-177"><a href="#cb39-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-178"><a href="#cb39-178" aria-hidden="true" tabindex="-1"></a><span class="in">di $nom  </span></span>
<span id="cb39-179"><a href="#cb39-179" aria-hidden="true" tabindex="-1"></a><span class="in">di "$nom"</span></span>
<span id="cb39-180"><a href="#cb39-180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-181"><a href="#cb39-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-182"><a href="#cb39-182" aria-hidden="true" tabindex="-1"></a><span class="fu">## **La commande levelsof**</span></span>
<span id="cb39-183"><a href="#cb39-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-184"><a href="#cb39-184" aria-hidden="true" tabindex="-1"></a>Cette commande particulièrement utile, pour ne pas dire incontournable, récupère les valeurs d’une variable et les enregistre dans une macro temporaire. **`levelsof`** précède régulièrement l’utilisation d’une boucle de type <span class="in">`foreach`</span>.   </span>
<span id="cb39-185"><a href="#cb39-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-186"><a href="#cb39-186" aria-hidden="true" tabindex="-1"></a>**Syntaxe**: **`levelsof nom_var [if/in], local(nom_macro)`**  </span>
<span id="cb39-187"><a href="#cb39-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-188"><a href="#cb39-188" aria-hidden="true" tabindex="-1"></a>***Exemple***</span>
<span id="cb39-189"><a href="#cb39-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-190"><a href="#cb39-190" aria-hidden="true" tabindex="-1"></a><span class="in">sysuse auto, clear</span></span>
<span id="cb39-191"><a href="#cb39-191" aria-hidden="true" tabindex="-1"></a><span class="in">label list origin</span></span>
<span id="cb39-192"><a href="#cb39-192" aria-hidden="true" tabindex="-1"></a><span class="in">origin:</span></span>
<span id="cb39-193"><a href="#cb39-193" aria-hidden="true" tabindex="-1"></a><span class="in">           0 Domestic</span></span>
<span id="cb39-194"><a href="#cb39-194" aria-hidden="true" tabindex="-1"></a><span class="in">           1 Foreign</span></span>
<span id="cb39-195"><a href="#cb39-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-196"><a href="#cb39-196" aria-hidden="true" tabindex="-1"></a><span class="in">levelsof foreign, local(f)</span></span>
<span id="cb39-197"><a href="#cb39-197" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _f</span></span>
<span id="cb39-198"><a href="#cb39-198" aria-hidden="true" tabindex="-1"></a><span class="in">_f: 0 1</span></span>
<span id="cb39-199"><a href="#cb39-199" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-200"><a href="#cb39-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-201"><a href="#cb39-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-202"><a href="#cb39-202" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip icon="false"}</span>
<span id="cb39-203"><a href="#cb39-203" aria-hidden="true" tabindex="-1"></a><span class="fu">## glevelsof</span></span>
<span id="cb39-204"><a href="#cb39-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-205"><a href="#cb39-205" aria-hidden="true" tabindex="-1"></a>Pour des grosses volumétries (&gt;1M) il est conseillé d'utiliser la commande **`glevelsof`** de *M.Caceres* (package <span class="in">`glevelsof`</span>):  </span>
<span id="cb39-206"><a href="#cb39-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-207"><a href="#cb39-207" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">gtools</span><span class="co">](https://gtools.readthedocs.io/en/latest/)</span></span>
<span id="cb39-208"><a href="#cb39-208" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">glevelsof</span><span class="co">](https://mthevenin.github.io/stata_programmation/speedup/gtools.html#glevelsof)</span></span>
<span id="cb39-209"><a href="#cb39-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-210"><a href="#cb39-210" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-211"><a href="#cb39-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-212"><a href="#cb39-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-213"><a href="#cb39-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-214"><a href="#cb39-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-215"><a href="#cb39-215" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Quelques fonctions associées à une macro**</span></span>
<span id="cb39-216"><a href="#cb39-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-217"><a href="#cb39-217" aria-hidden="true" tabindex="-1"></a>Il ne s’agit ici que de quelques fonctions utiles pour produire des graphiques et faciliter leur automatisation. L’ensemble des fonctions associées à une macro sont disponible dans l’aide (<span class="in">`help macro`</span>).  </span>
<span id="cb39-218"><a href="#cb39-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-219"><a href="#cb39-219" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb39-220"><a href="#cb39-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-221"><a href="#cb39-221" aria-hidden="true" tabindex="-1"></a><span class="fu">### word count</span></span>
<span id="cb39-222"><a href="#cb39-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-223"><a href="#cb39-223" aria-hidden="true" tabindex="-1"></a>Permet de compter le nombre de termes contenus dans une expression enregistrée sous forme de macro. Utile pour compter le nombre de boucles à effectuer avec <span class="in">`forvalue`</span>.  </span>
<span id="cb39-224"><a href="#cb39-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-225"><a href="#cb39-225" aria-hidden="true" tabindex="-1"></a>**Syntaxe**: **`Local/global : word count(nom_macro)`**  </span>
<span id="cb39-226"><a href="#cb39-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-227"><a href="#cb39-227" aria-hidden="true" tabindex="-1"></a>***Exemple***</span>
<span id="cb39-228"><a href="#cb39-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-229"><a href="#cb39-229" aria-hidden="true" tabindex="-1"></a><span class="in">levelsof rep78, local(r)</span></span>
<span id="cb39-230"><a href="#cb39-230" aria-hidden="true" tabindex="-1"></a><span class="in">1 2 3 4 5</span></span>
<span id="cb39-231"><a href="#cb39-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-232"><a href="#cb39-232" aria-hidden="true" tabindex="-1"></a><span class="in">local nombre: word count(`r')</span></span>
<span id="cb39-233"><a href="#cb39-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-234"><a href="#cb39-234" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _nombre</span></span>
<span id="cb39-235"><a href="#cb39-235" aria-hidden="true" tabindex="-1"></a><span class="in">_nombre:  5</span></span>
<span id="cb39-236"><a href="#cb39-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-237"><a href="#cb39-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-238"><a href="#cb39-238" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb39-239"><a href="#cb39-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-240"><a href="#cb39-240" aria-hidden="true" tabindex="-1"></a><span class="fu">### value label  </span></span>
<span id="cb39-241"><a href="#cb39-241" aria-hidden="true" tabindex="-1"></a>Récupère le nom d’un label affecté aux modalités d’une variable. Le nom de la variable peut-être enregistré en amont sous forme de macro.  </span>
<span id="cb39-242"><a href="#cb39-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-243"><a href="#cb39-243" aria-hidden="true" tabindex="-1"></a>**Syntaxe**: **`local/global nom_macro : value label nom_variable/nom_macro`**  </span>
<span id="cb39-244"><a href="#cb39-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-245"><a href="#cb39-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-246"><a href="#cb39-246" aria-hidden="true" tabindex="-1"></a><span class="in">local varname foreign</span></span>
<span id="cb39-247"><a href="#cb39-247" aria-hidden="true" tabindex="-1"></a><span class="in">local labn : value label `varname'</span></span>
<span id="cb39-248"><a href="#cb39-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-249"><a href="#cb39-249" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _labn</span></span>
<span id="cb39-250"><a href="#cb39-250" aria-hidden="true" tabindex="-1"></a><span class="in">_labn : origin</span></span>
<span id="cb39-251"><a href="#cb39-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-252"><a href="#cb39-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-253"><a href="#cb39-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-254"><a href="#cb39-254" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb39-255"><a href="#cb39-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-256"><a href="#cb39-256" aria-hidden="true" tabindex="-1"></a><span class="fu">### label  </span></span>
<span id="cb39-257"><a href="#cb39-257" aria-hidden="true" tabindex="-1"></a>Récupère l’expression de la modalité associée à une valeur d’un nom de label. Le nom du label peut avoir été enregistré en amont dans une macro (avec par exemple la fonction <span class="in">`value label`</span>). </span>
<span id="cb39-258"><a href="#cb39-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-259"><a href="#cb39-259" aria-hidden="true" tabindex="-1"></a>**Syntaxe**: **`local/global nom_macro : label nom_label valeur`**  </span>
<span id="cb39-260"><a href="#cb39-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-261"><a href="#cb39-261" aria-hidden="true" tabindex="-1"></a>***Exemple***: </span>
<span id="cb39-262"><a href="#cb39-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-263"><a href="#cb39-263" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-264"><a href="#cb39-264" aria-hidden="true" tabindex="-1"></a><span class="in">local lab0 : label origin 0</span></span>
<span id="cb39-265"><a href="#cb39-265" aria-hidden="true" tabindex="-1"></a><span class="in">local lab1 : label origin 0</span></span>
<span id="cb39-266"><a href="#cb39-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-267"><a href="#cb39-267" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _lab0</span></span>
<span id="cb39-268"><a href="#cb39-268" aria-hidden="true" tabindex="-1"></a><span class="in">lab0 : Domestic</span></span>
<span id="cb39-269"><a href="#cb39-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-270"><a href="#cb39-270" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _lab1</span></span>
<span id="cb39-271"><a href="#cb39-271" aria-hidden="true" tabindex="-1"></a><span class="in">lab1 : Foreign</span></span>
<span id="cb39-272"><a href="#cb39-272" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-273"><a href="#cb39-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-274"><a href="#cb39-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-275"><a href="#cb39-275" aria-hidden="true" tabindex="-1"></a>En récupérant en amont le nom du label (origin).  </span>
<span id="cb39-276"><a href="#cb39-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-277"><a href="#cb39-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-278"><a href="#cb39-278" aria-hidden="true" tabindex="-1"></a><span class="in">local labn: value label foreign</span></span>
<span id="cb39-279"><a href="#cb39-279" aria-hidden="true" tabindex="-1"></a><span class="in">local lab0: label `labn' 0</span></span>
<span id="cb39-280"><a href="#cb39-280" aria-hidden="true" tabindex="-1"></a><span class="in">local lab1: label `labn' 1</span></span>
<span id="cb39-281"><a href="#cb39-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-282"><a href="#cb39-282" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _lab0 _lab1</span></span>
<span id="cb39-283"><a href="#cb39-283" aria-hidden="true" tabindex="-1"></a><span class="in">_lab0 : Domestic</span></span>
<span id="cb39-284"><a href="#cb39-284" aria-hidden="true" tabindex="-1"></a><span class="in">_lab1 : Foreign</span></span>
<span id="cb39-285"><a href="#cb39-285" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-286"><a href="#cb39-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-287"><a href="#cb39-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-288"><a href="#cb39-288" aria-hidden="true" tabindex="-1"></a>En récupérant les valeurs de la variable avec levelsof, la modalité de chaque valeur peut-être récupérée dans une boucle <span class="in">`foreach`</span>.  </span>
<span id="cb39-289"><a href="#cb39-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-290"><a href="#cb39-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-291"><a href="#cb39-291" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-292"><a href="#cb39-292" aria-hidden="true" tabindex="-1"></a><span class="in">levelsof foreign, local(v)</span></span>
<span id="cb39-293"><a href="#cb39-293" aria-hidden="true" tabindex="-1"></a><span class="in">local labn: value label foreign</span></span>
<span id="cb39-294"><a href="#cb39-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-295"><a href="#cb39-295" aria-hidden="true" tabindex="-1"></a><span class="in">foreach val of local v {</span></span>
<span id="cb39-296"><a href="#cb39-296" aria-hidden="true" tabindex="-1"></a><span class="in">local lab`val': label `labn' `val'</span></span>
<span id="cb39-297"><a href="#cb39-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-298"><a href="#cb39-298" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _lab`val' </span></span>
<span id="cb39-299"><a href="#cb39-299" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb39-300"><a href="#cb39-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-301"><a href="#cb39-301" aria-hidden="true" tabindex="-1"></a><span class="in">_lab0 : Domestic</span></span>
<span id="cb39-302"><a href="#cb39-302" aria-hidden="true" tabindex="-1"></a><span class="in">_lab1 : Foreign</span></span>
<span id="cb39-303"><a href="#cb39-303" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-304"><a href="#cb39-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-305"><a href="#cb39-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-306"><a href="#cb39-306" aria-hidden="true" tabindex="-1"></a>En mettant dès le début une macro sur le nom de la variable, on automatise les modifications. Il est même possible de mettre dans la macro plusieurs variables, et effectuer l’opération dans une boucle principale.</span>
<span id="cb39-307"><a href="#cb39-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-308"><a href="#cb39-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-309"><a href="#cb39-309" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-310"><a href="#cb39-310" aria-hidden="true" tabindex="-1"></a><span class="in">local X foreign</span></span>
<span id="cb39-311"><a href="#cb39-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-312"><a href="#cb39-312" aria-hidden="true" tabindex="-1"></a><span class="in">levelsof `X', local(v)</span></span>
<span id="cb39-313"><a href="#cb39-313" aria-hidden="true" tabindex="-1"></a><span class="in">local labn: value label `X'</span></span>
<span id="cb39-314"><a href="#cb39-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-315"><a href="#cb39-315" aria-hidden="true" tabindex="-1"></a><span class="in">foreach val of local v {</span></span>
<span id="cb39-316"><a href="#cb39-316" aria-hidden="true" tabindex="-1"></a><span class="in">local lab`val': label `labn' `val'</span></span>
<span id="cb39-317"><a href="#cb39-317" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _lab`val' </span></span>
<span id="cb39-318"><a href="#cb39-318" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb39-319"><a href="#cb39-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-320"><a href="#cb39-320" aria-hidden="true" tabindex="-1"></a><span class="in">_lab0 : Domestic</span></span>
<span id="cb39-321"><a href="#cb39-321" aria-hidden="true" tabindex="-1"></a><span class="in">_lab1 : Foreign</span></span>
<span id="cb39-322"><a href="#cb39-322" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-323"><a href="#cb39-323" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb39-324"><a href="#cb39-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-325"><a href="#cb39-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-326"><a href="#cb39-326" aria-hidden="true" tabindex="-1"></a>***Graphique***   </span>
<span id="cb39-327"><a href="#cb39-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-328"><a href="#cb39-328" aria-hidden="true" tabindex="-1"></a>On va récupérer automatiquement les modalités d’une variable pour renseigner la légende.  </span>
<span id="cb39-329"><a href="#cb39-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-330"><a href="#cb39-330" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>La variable rep78 est regroupée en 2 modalités.</span>
<span id="cb39-331"><a href="#cb39-331" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Les modalités de la légende sont automatiquement insérées dans l’expression <span class="in">`legend(order(…)...)`</span>.</span>
<span id="cb39-332"><a href="#cb39-332" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Pour utiliser une autre variable que rep, il suffit de modifier le nom de la variable dans la première macro (X).</span>
<span id="cb39-333"><a href="#cb39-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-334"><a href="#cb39-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-335"><a href="#cb39-335" aria-hidden="true" tabindex="-1"></a><span class="in">sysuse auto, clear</span></span>
<span id="cb39-336"><a href="#cb39-336" aria-hidden="true" tabindex="-1"></a><span class="in">gen rep= rep78&lt;4</span></span>
<span id="cb39-337"><a href="#cb39-337" aria-hidden="true" tabindex="-1"></a><span class="in">label define rep 0 "rep&lt;4" 1 "rep&gt;=4", modify</span></span>
<span id="cb39-338"><a href="#cb39-338" aria-hidden="true" tabindex="-1"></a><span class="in">label value rep rep</span></span>
<span id="cb39-339"><a href="#cb39-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-340"><a href="#cb39-340" aria-hidden="true" tabindex="-1"></a><span class="in">*Récupération des modalités</span></span>
<span id="cb39-341"><a href="#cb39-341" aria-hidden="true" tabindex="-1"></a><span class="in">local X rep</span></span>
<span id="cb39-342"><a href="#cb39-342" aria-hidden="true" tabindex="-1"></a><span class="in">local labn: value label `X'</span></span>
<span id="cb39-343"><a href="#cb39-343" aria-hidden="true" tabindex="-1"></a><span class="in">levelsof `X', local(l)</span></span>
<span id="cb39-344"><a href="#cb39-344" aria-hidden="true" tabindex="-1"></a><span class="in">foreach l2 of local l {</span></span>
<span id="cb39-345"><a href="#cb39-345" aria-hidden="true" tabindex="-1"></a><span class="in">local lab`l2': label `labn' `l2'</span></span>
<span id="cb39-346"><a href="#cb39-346" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb39-347"><a href="#cb39-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-348"><a href="#cb39-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-349"><a href="#cb39-349" aria-hidden="true" tabindex="-1"></a><span class="in">*Graphique</span></span>
<span id="cb39-350"><a href="#cb39-350" aria-hidden="true" tabindex="-1"></a><span class="in">#delimit ;</span></span>
<span id="cb39-351"><a href="#cb39-351" aria-hidden="true" tabindex="-1"></a><span class="in">tw scatter price mpg if `X', </span></span>
<span id="cb39-352"><a href="#cb39-352" aria-hidden="true" tabindex="-1"></a><span class="in">   mc("237 248 177")   mlc(black) mlw(*.3)  msiz(*1.5) jitter(2)     </span></span>
<span id="cb39-353"><a href="#cb39-353" aria-hidden="true" tabindex="-1"></a><span class="in">|| scatter price mpg if !`X', </span></span>
<span id="cb39-354"><a href="#cb39-354" aria-hidden="true" tabindex="-1"></a><span class="in">   mc("65 182 196")    mlc(black) mlw(*.3) msiz(*1.5) jitter(2)  </span></span>
<span id="cb39-355"><a href="#cb39-355" aria-hidden="true" tabindex="-1"></a><span class="in">   </span></span>
<span id="cb39-356"><a href="#cb39-356" aria-hidden="true" tabindex="-1"></a><span class="in">|| , legend(order(1 "`lab0'" 2 "`lab1'") pos(11) region(color(%0)))         </span></span>
<span id="cb39-357"><a href="#cb39-357" aria-hidden="true" tabindex="-1"></a><span class="in">     title("Variable `X'") </span></span>
<span id="cb39-358"><a href="#cb39-358" aria-hidden="true" tabindex="-1"></a><span class="in">;</span></span>
<span id="cb39-359"><a href="#cb39-359" aria-hidden="true" tabindex="-1"></a><span class="in">#delimit cr</span></span>
<span id="cb39-360"><a href="#cb39-360" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-361"><a href="#cb39-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-362"><a href="#cb39-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-363"><a href="#cb39-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-364"><a href="#cb39-364" aria-hidden="true" tabindex="-1"></a><span class="al">![Macro: Légende automatique (a)](imgp2/g1a.png)</span>{width=60%}</span>
<span id="cb39-365"><a href="#cb39-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-366"><a href="#cb39-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-367"><a href="#cb39-367" aria-hidden="true" tabindex="-1"></a>Il suffit de modifier la première ligne qui enregistre le nom de la variable pour faire le même graphique avec la variable *foreign*: local X foreign.</span>
<span id="cb39-368"><a href="#cb39-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-369"><a href="#cb39-369" aria-hidden="true" tabindex="-1"></a><span class="al">![Macro: Légende automatique (b)](imgp2/g1b.png)</span>{width=60%}</span>
<span id="cb39-370"><a href="#cb39-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-371"><a href="#cb39-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-372"><a href="#cb39-372" aria-hidden="true" tabindex="-1"></a><span class="fu">###  Variable label </span></span>
<span id="cb39-373"><a href="#cb39-373" aria-hidden="true" tabindex="-1"></a>Récupère le label d’une variable sous forme du macro. Utile pour gérer une modification du titre des axes passer par les lignes de programme d’un graphique, et plus généralement pour donner de l’information sur variable de type continu ou de comptage sans label affecté au valeurs.  </span>
<span id="cb39-374"><a href="#cb39-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-375"><a href="#cb39-375" aria-hidden="true" tabindex="-1"></a>**Syntaxe**: **`local/global nom_macro : variable label variable/macro`**  </span>
<span id="cb39-376"><a href="#cb39-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-377"><a href="#cb39-377" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-378"><a href="#cb39-378" aria-hidden="true" tabindex="-1"></a><span class="in">local labv:  variable label foreign</span></span>
<span id="cb39-379"><a href="#cb39-379" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _labv</span></span>
<span id="cb39-380"><a href="#cb39-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-381"><a href="#cb39-381" aria-hidden="true" tabindex="-1"></a><span class="in">_labv : car type</span></span>
<span id="cb39-382"><a href="#cb39-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-383"><a href="#cb39-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-384"><a href="#cb39-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-385"><a href="#cb39-385" aria-hidden="true" tabindex="-1"></a>***Modification du format d’une valeur numérique*** (changement du nombre de décimale)  </span>
<span id="cb39-386"><a href="#cb39-386" aria-hidden="true" tabindex="-1"></a>Dans la section suivante, on va utiliser utiliser des objets de type macro qui sont générés après avoir exécuté une commande. Lorsque ces objets sont des valeurs statistiques comme des moyennes, estimateurs de regression etc., leur format enregistré comporte généralement un nombre important de décimales. Il est possible de modifier/réduire ce nombre de décimales avec la fonction <span class="in">`di`</span>.</span>
<span id="cb39-387"><a href="#cb39-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-388"><a href="#cb39-388" aria-hidden="true" tabindex="-1"></a>**Syntaxe**: **`local/global nom_macro : di format valeur/macro`**  </span>
<span id="cb39-389"><a href="#cb39-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-390"><a href="#cb39-390" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-391"><a href="#cb39-391" aria-hidden="true" tabindex="-1"></a><span class="in">local dec: di %6.2f 0.123456789</span></span>
<span id="cb39-392"><a href="#cb39-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-393"><a href="#cb39-393" aria-hidden="true" tabindex="-1"></a><span class="in">di `dec'</span></span>
<span id="cb39-394"><a href="#cb39-394" aria-hidden="true" tabindex="-1"></a><span class="in">.12</span></span>
<span id="cb39-395"><a href="#cb39-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-396"><a href="#cb39-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-397"><a href="#cb39-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-398"><a href="#cb39-398" aria-hidden="true" tabindex="-1"></a><span class="fu">## **return et ereturn**</span></span>
<span id="cb39-399"><a href="#cb39-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-400"><a href="#cb39-400" aria-hidden="true" tabindex="-1"></a>Après l’exécution d’une commande, un certain nombre d’objets sont conservés en mémoire jusqu’à l’exécution de la commande suivante. Leur liste est indiquée en bas du fichier d’aide.</span>
<span id="cb39-401"><a href="#cb39-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-402"><a href="#cb39-402" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>objets return: <span class="in">`r(nom_objet)`</span></span>
<span id="cb39-403"><a href="#cb39-403" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Affichage de la liste: <span class="in">`return list`</span></span>
<span id="cb39-404"><a href="#cb39-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-405"><a href="#cb39-405" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>objets ereturn: <span class="in">`e(nom_objet)`</span></span>
<span id="cb39-406"><a href="#cb39-406" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Affichage liste: <span class="in">`ereturn list`</span></span>
<span id="cb39-407"><a href="#cb39-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-408"><a href="#cb39-408" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-409"><a href="#cb39-409" aria-hidden="true" tabindex="-1"></a><span class="in">sum price, d</span></span>
<span id="cb39-410"><a href="#cb39-410" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-411"><a href="#cb39-411" aria-hidden="true" tabindex="-1"></a><span class="in">                            Price</span></span>
<span id="cb39-412"><a href="#cb39-412" aria-hidden="true" tabindex="-1"></a><span class="in">-------------------------------------------------------------</span></span>
<span id="cb39-413"><a href="#cb39-413" aria-hidden="true" tabindex="-1"></a><span class="in">      Percentiles      Smallest</span></span>
<span id="cb39-414"><a href="#cb39-414" aria-hidden="true" tabindex="-1"></a><span class="in"> 1%         3291           3291</span></span>
<span id="cb39-415"><a href="#cb39-415" aria-hidden="true" tabindex="-1"></a><span class="in"> 5%         3748           3299</span></span>
<span id="cb39-416"><a href="#cb39-416" aria-hidden="true" tabindex="-1"></a><span class="in">10%         3895           3667       Obs                  74</span></span>
<span id="cb39-417"><a href="#cb39-417" aria-hidden="true" tabindex="-1"></a><span class="in">25%         4195           3748       Sum of Wgt.          74</span></span>
<span id="cb39-418"><a href="#cb39-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-419"><a href="#cb39-419" aria-hidden="true" tabindex="-1"></a><span class="in">50%       5006.5                      Mean           6165.257</span></span>
<span id="cb39-420"><a href="#cb39-420" aria-hidden="true" tabindex="-1"></a><span class="in">                        Largest       Std. Dev.      2949.496</span></span>
<span id="cb39-421"><a href="#cb39-421" aria-hidden="true" tabindex="-1"></a><span class="in">75%         6342          13466</span></span>
<span id="cb39-422"><a href="#cb39-422" aria-hidden="true" tabindex="-1"></a><span class="in">90%        11385          13594       Variance        8699526</span></span>
<span id="cb39-423"><a href="#cb39-423" aria-hidden="true" tabindex="-1"></a><span class="in">95%        13466          14500       Skewness       1.653434</span></span>
<span id="cb39-424"><a href="#cb39-424" aria-hidden="true" tabindex="-1"></a><span class="in">99%        15906          15906       Kurtosis       4.819188</span></span>
<span id="cb39-425"><a href="#cb39-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-426"><a href="#cb39-426" aria-hidden="true" tabindex="-1"></a><span class="in">return list</span></span>
<span id="cb39-427"><a href="#cb39-427" aria-hidden="true" tabindex="-1"></a><span class="in">scalars:</span></span>
<span id="cb39-428"><a href="#cb39-428" aria-hidden="true" tabindex="-1"></a><span class="in">                  r(N) =  74</span></span>
<span id="cb39-429"><a href="#cb39-429" aria-hidden="true" tabindex="-1"></a><span class="in">              r(sum_w) =  74</span></span>
<span id="cb39-430"><a href="#cb39-430" aria-hidden="true" tabindex="-1"></a><span class="in">               r(mean) =  6165.256756756757</span></span>
<span id="cb39-431"><a href="#cb39-431" aria-hidden="true" tabindex="-1"></a><span class="in">                r(Var) =  8699525.97426879</span></span>
<span id="cb39-432"><a href="#cb39-432" aria-hidden="true" tabindex="-1"></a><span class="in">                 r(sd) =  2949.495884768919</span></span>
<span id="cb39-433"><a href="#cb39-433" aria-hidden="true" tabindex="-1"></a><span class="in">           r(skewness) =  1.653433511704859</span></span>
<span id="cb39-434"><a href="#cb39-434" aria-hidden="true" tabindex="-1"></a><span class="in">           r(kurtosis) =  4.819187528464004</span></span>
<span id="cb39-435"><a href="#cb39-435" aria-hidden="true" tabindex="-1"></a><span class="in">                r(sum) =  456229</span></span>
<span id="cb39-436"><a href="#cb39-436" aria-hidden="true" tabindex="-1"></a><span class="in">                r(min) =  3291</span></span>
<span id="cb39-437"><a href="#cb39-437" aria-hidden="true" tabindex="-1"></a><span class="in">                r(max) =  15906</span></span>
<span id="cb39-438"><a href="#cb39-438" aria-hidden="true" tabindex="-1"></a><span class="in">                 r(p1) =  3291</span></span>
<span id="cb39-439"><a href="#cb39-439" aria-hidden="true" tabindex="-1"></a><span class="in">                 r(p5) =  3748</span></span>
<span id="cb39-440"><a href="#cb39-440" aria-hidden="true" tabindex="-1"></a><span class="in">                r(p10) =  3895</span></span>
<span id="cb39-441"><a href="#cb39-441" aria-hidden="true" tabindex="-1"></a><span class="in">                r(p25) =  4195</span></span>
<span id="cb39-442"><a href="#cb39-442" aria-hidden="true" tabindex="-1"></a><span class="in">                r(p50) =  5006.5</span></span>
<span id="cb39-443"><a href="#cb39-443" aria-hidden="true" tabindex="-1"></a><span class="in">                r(p75) =  6342</span></span>
<span id="cb39-444"><a href="#cb39-444" aria-hidden="true" tabindex="-1"></a><span class="in">                r(p90) =  11385</span></span>
<span id="cb39-445"><a href="#cb39-445" aria-hidden="true" tabindex="-1"></a><span class="in">                r(p95) =  13466</span></span>
<span id="cb39-446"><a href="#cb39-446" aria-hidden="true" tabindex="-1"></a><span class="in">                r(p99) =  15906</span></span>
<span id="cb39-447"><a href="#cb39-447" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-448"><a href="#cb39-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-449"><a href="#cb39-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-450"><a href="#cb39-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-451"><a href="#cb39-451" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-452"><a href="#cb39-452" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum, d</span></span>
<span id="cb39-453"><a href="#cb39-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-454"><a href="#cb39-454" aria-hidden="true" tabindex="-1"></a><span class="in">di r(mean)</span></span>
<span id="cb39-455"><a href="#cb39-455" aria-hidden="true" tabindex="-1"></a><span class="in">.54054054</span></span>
<span id="cb39-456"><a href="#cb39-456" aria-hidden="true" tabindex="-1"></a><span class="in">di `r(mean)'</span></span>
<span id="cb39-457"><a href="#cb39-457" aria-hidden="true" tabindex="-1"></a><span class="in">.54054054</span></span>
<span id="cb39-458"><a href="#cb39-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-459"><a href="#cb39-459" aria-hidden="true" tabindex="-1"></a><span class="in">local mean r(mean)</span></span>
<span id="cb39-460"><a href="#cb39-460" aria-hidden="true" tabindex="-1"></a><span class="in">di `mean'</span></span>
<span id="cb39-461"><a href="#cb39-461" aria-hidden="true" tabindex="-1"></a><span class="in">.54054054</span></span>
<span id="cb39-462"><a href="#cb39-462" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _mean</span></span>
<span id="cb39-463"><a href="#cb39-463" aria-hidden="true" tabindex="-1"></a><span class="in">.5405405405405406</span></span>
<span id="cb39-464"><a href="#cb39-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-465"><a href="#cb39-465" aria-hidden="true" tabindex="-1"></a><span class="in">local mean : di %6.2f `r(mean)'</span></span>
<span id="cb39-466"><a href="#cb39-466" aria-hidden="true" tabindex="-1"></a><span class="in">di `mean'</span></span>
<span id="cb39-467"><a href="#cb39-467" aria-hidden="true" tabindex="-1"></a><span class="in">0.54</span></span>
<span id="cb39-468"><a href="#cb39-468" aria-hidden="true" tabindex="-1"></a><span class="in">mac list _mean</span></span>
<span id="cb39-469"><a href="#cb39-469" aria-hidden="true" tabindex="-1"></a><span class="in">_mean : 0.54</span></span>
<span id="cb39-470"><a href="#cb39-470" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-471"><a href="#cb39-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-472"><a href="#cb39-472" aria-hidden="true" tabindex="-1"></a>Au niveau d’un graphique ces objets permettent:  </span>
<span id="cb39-473"><a href="#cb39-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-474"><a href="#cb39-474" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>D’afficher des valeurs dans un graphique.</span>
<span id="cb39-475"><a href="#cb39-475" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>De générer automatiquement des éléments de type <span class="in">`xline`</span> <span class="in">`yline`</span>.</span>
<span id="cb39-476"><a href="#cb39-476" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>De générer des graphiques de type scatteri ou pci qui entrent directement les coordonnées au lieu des variables.</span>
<span id="cb39-477"><a href="#cb39-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-478"><a href="#cb39-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-479"><a href="#cb39-479" aria-hidden="true" tabindex="-1"></a>***Graphique***  </span>
<span id="cb39-480"><a href="#cb39-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-481"><a href="#cb39-481" aria-hidden="true" tabindex="-1"></a>On va tracer une droite sur chaque axe qui reporte les moyennes des variables price et mpg, les valeurs de ces moyennes sont reportés en bas du graphique en tant que note</span>
<span id="cb39-482"><a href="#cb39-482" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-483"><a href="#cb39-483" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Récupération des moyennes de *price* et *mpg*</span>
<span id="cb39-484"><a href="#cb39-484" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>les noms des macros seront *mprice* et * mpg*</span>
<span id="cb39-485"><a href="#cb39-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-486"><a href="#cb39-486" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-487"><a href="#cb39-487" aria-hidden="true" tabindex="-1"></a><span class="in">local varlist price mpg</span></span>
<span id="cb39-488"><a href="#cb39-488" aria-hidden="true" tabindex="-1"></a><span class="in">foreach v of local varlist {</span></span>
<span id="cb39-489"><a href="#cb39-489" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum `v'</span></span>
<span id="cb39-490"><a href="#cb39-490" aria-hidden="true" tabindex="-1"></a><span class="in">local  m`v' : di %6.2f `r(mean)'</span></span>
<span id="cb39-491"><a href="#cb39-491" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb39-492"><a href="#cb39-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-493"><a href="#cb39-493" aria-hidden="true" tabindex="-1"></a><span class="in">* Récupération des labels de la variable foreign</span></span>
<span id="cb39-494"><a href="#cb39-494" aria-hidden="true" tabindex="-1"></a><span class="in">local X foreign</span></span>
<span id="cb39-495"><a href="#cb39-495" aria-hidden="true" tabindex="-1"></a><span class="in">local labn: value label `X'</span></span>
<span id="cb39-496"><a href="#cb39-496" aria-hidden="true" tabindex="-1"></a><span class="in">levelsof `X', local(l)</span></span>
<span id="cb39-497"><a href="#cb39-497" aria-hidden="true" tabindex="-1"></a><span class="in">foreach l2 of local l {</span></span>
<span id="cb39-498"><a href="#cb39-498" aria-hidden="true" tabindex="-1"></a><span class="in">local lab`l2': label `labn'  `l2'</span></span>
<span id="cb39-499"><a href="#cb39-499" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb39-500"><a href="#cb39-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-501"><a href="#cb39-501" aria-hidden="true" tabindex="-1"></a><span class="in">* Graphique</span></span>
<span id="cb39-502"><a href="#cb39-502" aria-hidden="true" tabindex="-1"></a><span class="in">#delimit ; </span></span>
<span id="cb39-503"><a href="#cb39-503" aria-hidden="true" tabindex="-1"></a><span class="in">tw scatter price mpg if !foreign, </span></span>
<span id="cb39-504"><a href="#cb39-504" aria-hidden="true" tabindex="-1"></a><span class="in">   mlc(black) mlw(*.3) mc("254 196 79") msiz(*1.5)  jitter(2) </span></span>
<span id="cb39-505"><a href="#cb39-505" aria-hidden="true" tabindex="-1"></a><span class="in">|| scatter price mpg if foreign,</span></span>
<span id="cb39-506"><a href="#cb39-506" aria-hidden="true" tabindex="-1"></a><span class="in">   mlc(black) mlw(*.3) mc("153 52 4")   msiz(*1.5)  jitter(2) </span></span>
<span id="cb39-507"><a href="#cb39-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-508"><a href="#cb39-508" aria-hidden="true" tabindex="-1"></a><span class="in">|| , legend(order(1 "`lab0'" 2 "`lab1'") pos(11) region(color(%0))) </span></span>
<span id="cb39-509"><a href="#cb39-509" aria-hidden="true" tabindex="-1"></a><span class="in">     yline(`mprice', lc("236 112 20") lw(*1.5)) </span></span>
<span id="cb39-510"><a href="#cb39-510" aria-hidden="true" tabindex="-1"></a><span class="in">     xline(`mmpg'  , lc("236 112 20") lw(*1.5))</span></span>
<span id="cb39-511"><a href="#cb39-511" aria-hidden="true" tabindex="-1"></a><span class="in">     note("{bf:Moyenne Price = `mprice'}" </span></span>
<span id="cb39-512"><a href="#cb39-512" aria-hidden="true" tabindex="-1"></a><span class="in">        "{bf:Moyenne Mpg   = `mmpg'}")</span></span>
<span id="cb39-513"><a href="#cb39-513" aria-hidden="true" tabindex="-1"></a><span class="in">;</span></span>
<span id="cb39-514"><a href="#cb39-514" aria-hidden="true" tabindex="-1"></a><span class="in">#delimit cr</span></span>
<span id="cb39-515"><a href="#cb39-515" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-516"><a href="#cb39-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-517"><a href="#cb39-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-518"><a href="#cb39-518" aria-hidden="true" tabindex="-1"></a><span class="al">![xline - yline: récupération des valeurs dans une macro](imgp2/g2.png)</span>{width=60%}</span>
<span id="cb39-519"><a href="#cb39-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-520"><a href="#cb39-520" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Compteurs i++**</span></span>
<span id="cb39-521"><a href="#cb39-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-522"><a href="#cb39-522" aria-hidden="true" tabindex="-1"></a>Les compteurs vont s’avérer très utiles dans les expressions en boucle pour générer une valeur incrémentale de type macro. C’est sur ce principe que fonctionne les boucles de type <span class="in">`forvalue`</span>, mais il est possible de les générer dans une boucle de type <span class="in">`foreach`</span>.</span>
<span id="cb39-523"><a href="#cb39-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-524"><a href="#cb39-524" aria-hidden="true" tabindex="-1"></a>***Exemple1***: on initialise un compteur <span class="in">`i`</span>. Dans une boucle <span class="in">`forvalue`</span> dont l’incrément va de 10 à 15 ($\delta=+1$), on génère à chaque boucle une valeur allant de 1 à 6 avec la macro `<span class="in">`i++'`</span>. </span>
<span id="cb39-525"><a href="#cb39-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-526"><a href="#cb39-526" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-527"><a href="#cb39-527" aria-hidden="true" tabindex="-1"></a><span class="in">local i = 1</span></span>
<span id="cb39-528"><a href="#cb39-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-529"><a href="#cb39-529" aria-hidden="true" tabindex="-1"></a><span class="in">forvalue k = 10/15 {</span></span>
<span id="cb39-530"><a href="#cb39-530" aria-hidden="true" tabindex="-1"></a><span class="in">di "k=`k' =&gt; i=`i++'"   </span></span>
<span id="cb39-531"><a href="#cb39-531" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb39-532"><a href="#cb39-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-533"><a href="#cb39-533" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-534"><a href="#cb39-534" aria-hidden="true" tabindex="-1"></a><span class="in">k=10 =&gt; i=1</span></span>
<span id="cb39-535"><a href="#cb39-535" aria-hidden="true" tabindex="-1"></a><span class="in">k=11 =&gt; i=2</span></span>
<span id="cb39-536"><a href="#cb39-536" aria-hidden="true" tabindex="-1"></a><span class="in">k=12 =&gt; i=3</span></span>
<span id="cb39-537"><a href="#cb39-537" aria-hidden="true" tabindex="-1"></a><span class="in">k=13 =&gt; i=4</span></span>
<span id="cb39-538"><a href="#cb39-538" aria-hidden="true" tabindex="-1"></a><span class="in">k=14 =&gt; i=5</span></span>
<span id="cb39-539"><a href="#cb39-539" aria-hidden="true" tabindex="-1"></a><span class="in">k=15 =&gt; i=6</span></span>
<span id="cb39-540"><a href="#cb39-540" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-541"><a href="#cb39-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-542"><a href="#cb39-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-543"><a href="#cb39-543" aria-hidden="true" tabindex="-1"></a>***Exemple 2***: on va afficher les noms d’une liste de variable en noms génériques dans une boucle <span class="in">`foreach`</span>.</span>
<span id="cb39-544"><a href="#cb39-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-545"><a href="#cb39-545" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata,  eval=FALSE}</span></span>
<span id="cb39-546"><a href="#cb39-546" aria-hidden="true" tabindex="-1"></a><span class="in">local i=1</span></span>
<span id="cb39-547"><a href="#cb39-547" aria-hidden="true" tabindex="-1"></a><span class="in">local varlist price mpg turn length</span></span>
<span id="cb39-548"><a href="#cb39-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-549"><a href="#cb39-549" aria-hidden="true" tabindex="-1"></a><span class="in">foreach v of local varlist  {</span></span>
<span id="cb39-550"><a href="#cb39-550" aria-hidden="true" tabindex="-1"></a><span class="in">di "variable`i++' = `v'"        </span></span>
<span id="cb39-551"><a href="#cb39-551" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb39-552"><a href="#cb39-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-553"><a href="#cb39-553" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-554"><a href="#cb39-554" aria-hidden="true" tabindex="-1"></a><span class="in">variable1 = price</span></span>
<span id="cb39-555"><a href="#cb39-555" aria-hidden="true" tabindex="-1"></a><span class="in">variable2 = mpg</span></span>
<span id="cb39-556"><a href="#cb39-556" aria-hidden="true" tabindex="-1"></a><span class="in">variable3 = turn</span></span>
<span id="cb39-557"><a href="#cb39-557" aria-hidden="true" tabindex="-1"></a><span class="in">variable4 = length</span></span>
<span id="cb39-558"><a href="#cb39-558" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-559"><a href="#cb39-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-560"><a href="#cb39-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-561"><a href="#cb39-561" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;br&gt;</span></span>
<span id="cb39-562"><a href="#cb39-562" aria-hidden="true" tabindex="-1"></a>**Point de vigilance**</span>
<span id="cb39-563"><a href="#cb39-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-564"><a href="#cb39-564" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb39-565"><a href="#cb39-565" aria-hidden="true" tabindex="-1"></a>Appels multiples d’un compteur dans une boucle.</span>
<span id="cb39-566"><a href="#cb39-566" aria-hidden="true" tabindex="-1"></a>Dans les exemples précédents, le compteur n’a été utilisé qu’une fois dans une itération. Il est important de noter que le compteur peut continuer à incrémenter lorsqu’il est appelé plusieurs fois dans une itération. Nous allons présenter les différents comportements du compteur, et le moyen de fixer sa valeur dans une itération avec des appels multiples.</span>
<span id="cb39-567"><a href="#cb39-567" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb39-568"><a href="#cb39-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-569"><a href="#cb39-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-570"><a href="#cb39-570" aria-hidden="true" tabindex="-1"></a>***Situation1***: Un seul appel du compteur (cas standard)</span>
<span id="cb39-571"><a href="#cb39-571" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-572"><a href="#cb39-572" aria-hidden="true" tabindex="-1"></a><span class="in">forv i=1/5 {</span></span>
<span id="cb39-573"><a href="#cb39-573" aria-hidden="true" tabindex="-1"></a><span class="in">  di "iteration `i': i++ ="  `i++' </span></span>
<span id="cb39-574"><a href="#cb39-574" aria-hidden="true" tabindex="-1"></a><span class="in">   }</span></span>
<span id="cb39-575"><a href="#cb39-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-576"><a href="#cb39-576" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-577"><a href="#cb39-577" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 1: i++ =1</span></span>
<span id="cb39-578"><a href="#cb39-578" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 2: i++ =2</span></span>
<span id="cb39-579"><a href="#cb39-579" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 3: i++ =3</span></span>
<span id="cb39-580"><a href="#cb39-580" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 4: i++ =4</span></span>
<span id="cb39-581"><a href="#cb39-581" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 5: i++ =5</span></span>
<span id="cb39-582"><a href="#cb39-582" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-583"><a href="#cb39-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-584"><a href="#cb39-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-585"><a href="#cb39-585" aria-hidden="true" tabindex="-1"></a>***Situation2***: Plusieurs appels dans une itération dans une boucle standard : la valeur du compteur est fixe dans chaque itération, mais pour la première et la dernière, le second appel est ignoré.   </span>
<span id="cb39-586"><a href="#cb39-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-587"><a href="#cb39-587" aria-hidden="true" tabindex="-1"></a><span class="in">forv i=1/5 {</span></span>
<span id="cb39-588"><a href="#cb39-588" aria-hidden="true" tabindex="-1"></a><span class="in">di "iteration `i': i++ ="  `i++' </span></span>
<span id="cb39-589"><a href="#cb39-589" aria-hidden="true" tabindex="-1"></a><span class="in">di "iteration `i': i++ ="  `i++' </span></span>
<span id="cb39-590"><a href="#cb39-590" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb39-591"><a href="#cb39-591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-592"><a href="#cb39-592" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-593"><a href="#cb39-593" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 1: i++ =1</span></span>
<span id="cb39-594"><a href="#cb39-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-595"><a href="#cb39-595" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 2: i++ =2</span></span>
<span id="cb39-596"><a href="#cb39-596" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 2: i++ =2</span></span>
<span id="cb39-597"><a href="#cb39-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-598"><a href="#cb39-598" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 3: i++ =3</span></span>
<span id="cb39-599"><a href="#cb39-599" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 3: i++ =3</span></span>
<span id="cb39-600"><a href="#cb39-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-601"><a href="#cb39-601" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 4: i++ =4</span></span>
<span id="cb39-602"><a href="#cb39-602" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 4: i++ =4</span></span>
<span id="cb39-603"><a href="#cb39-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-604"><a href="#cb39-604" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 5: i++ =5</span></span>
<span id="cb39-605"><a href="#cb39-605" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 5: i++ =5</span></span>
<span id="cb39-606"><a href="#cb39-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-607"><a href="#cb39-607" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 6: i++ =6</span></span>
<span id="cb39-608"><a href="#cb39-608" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-609"><a href="#cb39-609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-610"><a href="#cb39-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-611"><a href="#cb39-611" aria-hidden="true" tabindex="-1"></a>***Situation3***: On initialise le compteur en amont (**k***), il continue d’incrémenter dans chaque itération.</span>
<span id="cb39-612"><a href="#cb39-612" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-613"><a href="#cb39-613" aria-hidden="true" tabindex="-1"></a><span class="in">local k=1</span></span>
<span id="cb39-614"><a href="#cb39-614" aria-hidden="true" tabindex="-1"></a><span class="in">forv i=1/5 {</span></span>
<span id="cb39-615"><a href="#cb39-615" aria-hidden="true" tabindex="-1"></a><span class="in">  di "iteration `i': "  `k++'</span></span>
<span id="cb39-616"><a href="#cb39-616" aria-hidden="true" tabindex="-1"></a><span class="in">  di "iteration `i': "  `k++'</span></span>
<span id="cb39-617"><a href="#cb39-617" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb39-618"><a href="#cb39-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-619"><a href="#cb39-619" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-620"><a href="#cb39-620" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 1: 1</span></span>
<span id="cb39-621"><a href="#cb39-621" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 1: 2</span></span>
<span id="cb39-622"><a href="#cb39-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-623"><a href="#cb39-623" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 2: 3</span></span>
<span id="cb39-624"><a href="#cb39-624" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 2: 4</span></span>
<span id="cb39-625"><a href="#cb39-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-626"><a href="#cb39-626" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 3: 5</span></span>
<span id="cb39-627"><a href="#cb39-627" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 3: 6</span></span>
<span id="cb39-628"><a href="#cb39-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-629"><a href="#cb39-629" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 4: 7</span></span>
<span id="cb39-630"><a href="#cb39-630" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 4: 8</span></span>
<span id="cb39-631"><a href="#cb39-631" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 5: 9</span></span>
<span id="cb39-632"><a href="#cb39-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-633"><a href="#cb39-633" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 5: 10</span></span>
<span id="cb39-634"><a href="#cb39-634" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-635"><a href="#cb39-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-636"><a href="#cb39-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-637"><a href="#cb39-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-638"><a href="#cb39-638" aria-hidden="true" tabindex="-1"></a>***Situation4***: le compteur est appelé plusieurs fois. On veut fixer sa valeur pour qu’elle soit égale à la valeur de l’itération, sans rencontrer le problème de la situation2 avec un appel simple à la première et dernière itération. On va devoir initialiser un nouveau compteur à l’intérieur de la boucle, à chaque itération (compteur ***j***). </span>
<span id="cb39-639"><a href="#cb39-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-640"><a href="#cb39-640" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-641"><a href="#cb39-641" aria-hidden="true" tabindex="-1"></a><span class="in">local k=1</span></span>
<span id="cb39-642"><a href="#cb39-642" aria-hidden="true" tabindex="-1"></a><span class="in">forv i=1/5 {</span></span>
<span id="cb39-643"><a href="#cb39-643" aria-hidden="true" tabindex="-1"></a><span class="in"> local j = `k++'</span></span>
<span id="cb39-644"><a href="#cb39-644" aria-hidden="true" tabindex="-1"></a><span class="in"> di "iteration `i': "  `j'</span></span>
<span id="cb39-645"><a href="#cb39-645" aria-hidden="true" tabindex="-1"></a><span class="in"> di "iteration `i': "  `j'</span></span>
<span id="cb39-646"><a href="#cb39-646" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb39-647"><a href="#cb39-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-648"><a href="#cb39-648" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-649"><a href="#cb39-649" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 1: 1</span></span>
<span id="cb39-650"><a href="#cb39-650" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 1: 1</span></span>
<span id="cb39-651"><a href="#cb39-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-652"><a href="#cb39-652" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 2: 2</span></span>
<span id="cb39-653"><a href="#cb39-653" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 2: 2</span></span>
<span id="cb39-654"><a href="#cb39-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-655"><a href="#cb39-655" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 3: 3</span></span>
<span id="cb39-656"><a href="#cb39-656" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 3: 3</span></span>
<span id="cb39-657"><a href="#cb39-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-658"><a href="#cb39-658" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 4: 4</span></span>
<span id="cb39-659"><a href="#cb39-659" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 4: 4</span></span>
<span id="cb39-660"><a href="#cb39-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-661"><a href="#cb39-661" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 5: 5</span></span>
<span id="cb39-662"><a href="#cb39-662" aria-hidden="true" tabindex="-1"></a><span class="in">iteration 5: 5</span></span>
<span id="cb39-663"><a href="#cb39-663" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-664"><a href="#cb39-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-665"><a href="#cb39-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-666"><a href="#cb39-666" aria-hidden="true" tabindex="-1"></a>Si le compteur est utilisé plusieurs dans une itération et que sa valeur y doit être fixe, on devra donc utiliser cette dernière expression.   </span>
<span id="cb39-667"><a href="#cb39-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-668"><a href="#cb39-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-669"><a href="#cb39-669" aria-hidden="true" tabindex="-1"></a>**Graphique**</span>
<span id="cb39-670"><a href="#cb39-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-671"><a href="#cb39-671" aria-hidden="true" tabindex="-1"></a>Le graphique suivant donne la distribution de la variable displacement selon le nombre de réparation (variable **rep78**). Pour chaque valeur de ***rep78***, la moyenne de displacement est reportée. Ces moyennes sont connectées à la moyenne calculée sur l’ensemble des voitures. On retrouve le principe d’un graphique de type « **lollipop** ».  </span>
<span id="cb39-672"><a href="#cb39-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-673"><a href="#cb39-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-674"><a href="#cb39-674" aria-hidden="true" tabindex="-1"></a><span class="in">local i=1</span></span>
<span id="cb39-675"><a href="#cb39-675" aria-hidden="true" tabindex="-1"></a><span class="in">levelsof rep78, local(l)</span></span>
<span id="cb39-676"><a href="#cb39-676" aria-hidden="true" tabindex="-1"></a><span class="in">foreach v of local l {</span></span>
<span id="cb39-677"><a href="#cb39-677" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum displacement  if rep78==`v'</span></span>
<span id="cb39-678"><a href="#cb39-678" aria-hidden="true" tabindex="-1"></a><span class="in">local m`i++' = `r(mean)'</span></span>
<span id="cb39-679"><a href="#cb39-679" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb39-680"><a href="#cb39-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-681"><a href="#cb39-681" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum displacement </span></span>
<span id="cb39-682"><a href="#cb39-682" aria-hidden="true" tabindex="-1"></a><span class="in">local mean `r(mean)'</span></span>
<span id="cb39-683"><a href="#cb39-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-684"><a href="#cb39-684" aria-hidden="true" tabindex="-1"></a><span class="in">#delimit ;</span></span>
<span id="cb39-685"><a href="#cb39-685" aria-hidden="true" tabindex="-1"></a><span class="in">tw  scatteri 2 `m1',  msymbol(|) mc("210 50 0") msize(*5) mlw(*3)</span></span>
<span id="cb39-686"><a href="#cb39-686" aria-hidden="true" tabindex="-1"></a><span class="in">||  scatteri 3 `m2',  msymbol(|) mc("210 50 0") msize(*5) mlw(*3)</span></span>
<span id="cb39-687"><a href="#cb39-687" aria-hidden="true" tabindex="-1"></a><span class="in">||  scatteri 4 `m3',  msymbol(|) mc("210 50 0") msize(*5) mlw(*3)</span></span>
<span id="cb39-688"><a href="#cb39-688" aria-hidden="true" tabindex="-1"></a><span class="in">||  scatteri 5 `m4',  msymbol(|) mc("210 50 0") msize(*5) mlw(*3)</span></span>
<span id="cb39-689"><a href="#cb39-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-690"><a href="#cb39-690" aria-hidden="true" tabindex="-1"></a><span class="in">|| pci 2 `mean' 5 `mean', lw(*2.5) lc("210 50 0")</span></span>
<span id="cb39-691"><a href="#cb39-691" aria-hidden="true" tabindex="-1"></a><span class="in">|| pci 2 `mean' 2 `m1'  , lw(*2.5) lc("210 50 0")</span></span>
<span id="cb39-692"><a href="#cb39-692" aria-hidden="true" tabindex="-1"></a><span class="in">|| pci 3 `mean' 3 `m2'  , lw(*2.5) lc("210 50 0")</span></span>
<span id="cb39-693"><a href="#cb39-693" aria-hidden="true" tabindex="-1"></a><span class="in">|| pci 4 `mean' 4 `m3'  , lw(*2.5) lc("210 50 0")</span></span>
<span id="cb39-694"><a href="#cb39-694" aria-hidden="true" tabindex="-1"></a><span class="in">|| pci 5 `mean' 5 `m4'  , lw(*2.5) lc("255 50 0")</span></span>
<span id="cb39-695"><a href="#cb39-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-696"><a href="#cb39-696" aria-hidden="true" tabindex="-1"></a><span class="in">||  scatter rep78 displacement,  mc("255 117 0%70") mlc(210 50 0) mlw(*.5) msize(*1) jitter(5) || , </span></span>
<span id="cb39-697"><a href="#cb39-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-698"><a href="#cb39-698" aria-hidden="true" tabindex="-1"></a><span class="in">xlabel(,glw(*1.2)) ylabel(,glw(*.5) angle(0)) yscale(range(1.8, 5.2))</span></span>
<span id="cb39-699"><a href="#cb39-699" aria-hidden="true" tabindex="-1"></a><span class="in">legend(off)</span></span>
<span id="cb39-700"><a href="#cb39-700" aria-hidden="true" tabindex="-1"></a><span class="in">title("Averages of displacement") ytitle("Number of repairs")</span></span>
<span id="cb39-701"><a href="#cb39-701" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-702"><a href="#cb39-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-703"><a href="#cb39-703" aria-hidden="true" tabindex="-1"></a><span class="al">![Graphique avec compteur et objet de type `r()`](imgp2/g3.png)</span>{width=60%}</span>
<span id="cb39-704"><a href="#cb39-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-705"><a href="#cb39-705" aria-hidden="true" tabindex="-1"></a>***Pas à pas du programme***   </span>
<span id="cb39-706"><a href="#cb39-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-707"><a href="#cb39-707" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-708"><a href="#cb39-708" aria-hidden="true" tabindex="-1"></a><span class="in">recode rep78 (1=2)</span></span>
<span id="cb39-709"><a href="#cb39-709" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-710"><a href="#cb39-710" aria-hidden="true" tabindex="-1"></a><span class="in">local i=1</span></span>
<span id="cb39-711"><a href="#cb39-711" aria-hidden="true" tabindex="-1"></a><span class="in">levelsof rep78, local(l)</span></span>
<span id="cb39-712"><a href="#cb39-712" aria-hidden="true" tabindex="-1"></a><span class="in">foreach v of local l {</span></span>
<span id="cb39-713"><a href="#cb39-713" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum displacement  if rep78==`v'</span></span>
<span id="cb39-714"><a href="#cb39-714" aria-hidden="true" tabindex="-1"></a><span class="in">local m`i++' = `r(mean)'</span></span>
<span id="cb39-715"><a href="#cb39-715" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb39-716"><a href="#cb39-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-717"><a href="#cb39-717" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum displacement </span></span>
<span id="cb39-718"><a href="#cb39-718" aria-hidden="true" tabindex="-1"></a><span class="in">local mean `r(mean)'</span></span>
<span id="cb39-719"><a href="#cb39-719" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-720"><a href="#cb39-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-721"><a href="#cb39-721" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On regroupe les deux premières valeurs de ***rep78*** (peu d’observations).</span>
<span id="cb39-722"><a href="#cb39-722" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On initialise le compteur qui sera utilisé dans une boucle <span class="in">`foreach`</span>.</span>
<span id="cb39-723"><a href="#cb39-723" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On récupère les valeurs de la variable ***rep78*** avec <span class="in">`levelsof`</span>.</span>
<span id="cb39-724"><a href="#cb39-724" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Dans la boucle on récupère les valeurs des moyennes de ***displacement*** pour chaque valeur de `rep78`. Elles sont enregistrées dans les expressions macro ***m1*** à ***m4***. Les valeurs 1 à 4 sont générées par le compteur <span class="in">`i++`</span>.</span>
<span id="cb39-725"><a href="#cb39-725" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On récupère la moyenne pour l’ensemble des voitures. Elle est enregistrée dans la macro ***mean***.</span>
<span id="cb39-726"><a href="#cb39-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-727"><a href="#cb39-727" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-728"><a href="#cb39-728" aria-hidden="true" tabindex="-1"></a><span class="in">#delimit ;</span></span>
<span id="cb39-729"><a href="#cb39-729" aria-hidden="true" tabindex="-1"></a><span class="in">tw  scatteri 2 `m1',  msymbol(|) mc("210 50 0") msize(*5) mlw(*3)</span></span>
<span id="cb39-730"><a href="#cb39-730" aria-hidden="true" tabindex="-1"></a><span class="in">||  scatteri 3 `m2',  msymbol(|) mc("210 50 0") msize(*5) mlw(*3)</span></span>
<span id="cb39-731"><a href="#cb39-731" aria-hidden="true" tabindex="-1"></a><span class="in">||  scatteri 4 `m3',  msymbol(|) mc("210 50 0") msize(*5) mlw(*3)</span></span>
<span id="cb39-732"><a href="#cb39-732" aria-hidden="true" tabindex="-1"></a><span class="in">||  scatteri 5 `m4',  msymbol(|) mc("210 50 0") msize(*5) mlw(*3)</span></span>
<span id="cb39-733"><a href="#cb39-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-734"><a href="#cb39-734" aria-hidden="true" tabindex="-1"></a><span class="in">|| pci 2 `mean' 5 `mean', lw(*2.5) lc("210 50 0")</span></span>
<span id="cb39-735"><a href="#cb39-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-736"><a href="#cb39-736" aria-hidden="true" tabindex="-1"></a><span class="in">|| pci 2 `mean' 2 `m1'  , lw(*2.5) lc("210 50 0")</span></span>
<span id="cb39-737"><a href="#cb39-737" aria-hidden="true" tabindex="-1"></a><span class="in">|| pci 3 `mean' 3 `m2'  , lw(*2.5) lc("210 50 0")</span></span>
<span id="cb39-738"><a href="#cb39-738" aria-hidden="true" tabindex="-1"></a><span class="in">|| pci 4 `mean' 4 `m3'  , lw(*2.5) lc("210 50 0")</span></span>
<span id="cb39-739"><a href="#cb39-739" aria-hidden="true" tabindex="-1"></a><span class="in">|| pci 5 `mean' 5 `m4'  , lw(*2.5) lc("255 50 0")</span></span>
<span id="cb39-740"><a href="#cb39-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-741"><a href="#cb39-741" aria-hidden="true" tabindex="-1"></a><span class="in">|| scatter rep78 displacement, mc("255 117 0%70") mlc(210 50 0) mlw(*.5)</span></span>
<span id="cb39-742"><a href="#cb39-742" aria-hidden="true" tabindex="-1"></a><span class="in">   msize(*1) jitter(5)</span></span>
<span id="cb39-743"><a href="#cb39-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-744"><a href="#cb39-744" aria-hidden="true" tabindex="-1"></a><span class="in">|| , xlabel(,glw(*1.2)) ylabel(,glw(*.5) angle(0)) yscale(range(1.8, 5.2))</span></span>
<span id="cb39-745"><a href="#cb39-745" aria-hidden="true" tabindex="-1"></a><span class="in">     legend(off)</span></span>
<span id="cb39-746"><a href="#cb39-746" aria-hidden="true" tabindex="-1"></a><span class="in">     title("Averages of displacement") ytitle("Number of repairs");</span></span>
<span id="cb39-747"><a href="#cb39-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-748"><a href="#cb39-748" aria-hidden="true" tabindex="-1"></a><span class="in">#delimit cr</span></span>
<span id="cb39-749"><a href="#cb39-749" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-750"><a href="#cb39-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-751"><a href="#cb39-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-752"><a href="#cb39-752" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Pour faciliter l’écriture et la lecture du programme on change de type de délimiteur.</span>
<span id="cb39-753"><a href="#cb39-753" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Les moyennes par niveau de réparation seront en arrière plan pour visualiser les valeurs de toutes les voitures. </span>
<span id="cb39-754"><a href="#cb39-754" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On utilise ***`scatteri`*** pour générer le nuage des moyennes pour chaque niveau de réparation. Les valeurs de ces dernières sont connues (de 2 à 5) et les moyennes de displacement on été enregistrées dans les macros m1 à m4. Pour le premier niveau de réparation le nuage est donc généré par **scatteri 2 `m1'** <span class="co">[</span><span class="ot">`scatteri valeur_Y valeur_X`</span><span class="co">]</span>. On a utilisé un symbole de type ***pipe*** au lieu d’une bulle <span class="co">[</span><span class="ot">`msymbol(|)`</span><span class="co">]</span>.</span>
<span id="cb39-755"><a href="#cb39-755" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On trace une droite verticale avec la fonction <span class="in">`pci`</span> pour indiquer la moyenne de displacement pour l’ensemble des voitures. La valeur de cette moyenne (X) a été calculée en amont (macro ***mean***) et on connait les valeurs de Y. La droite est donc générée par pci 2 <span class="in">`mean' 5 `</span>mean' <span class="co">[</span><span class="ot">`pci min_Y min_X max_Y max_X`</span><span class="co">]</span>.</span>
<span id="cb39-756"><a href="#cb39-756" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>On va connecter la valeur des moyennes pour chaque niveau de réparation avec la moyenne d’ensemble. On va ici tracer des droites horizontale, dont les coordonnées Y seront cette fois ci fixe, et le minimum de X toujours égal à la moyenne d’ensemble. Pour le premier niveau de réparation :  **pci 2 `mean' 2 `m1'**.</span>
<span id="cb39-757"><a href="#cb39-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-758"><a href="#cb39-758" aria-hidden="true" tabindex="-1"></a>***Remarque***: on pourrait améliorer le rendu de l’angle pour la connection des moyennes en modifiant légèrement les valeurs de Y_min et Y_max pour la droite verticale, avec par exemple : ***pci 1.985 `mean' 5.015 `mean', lw(*2.5) lc("210 50 0")***.  </span>
<span id="cb39-759"><a href="#cb39-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-760"><a href="#cb39-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-761"><a href="#cb39-761" aria-hidden="true" tabindex="-1"></a><span class="fu">## **Autres objets macro: token, tempvar**</span></span>
<span id="cb39-762"><a href="#cb39-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-763"><a href="#cb39-763" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Token**  </span></span>
<span id="cb39-764"><a href="#cb39-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-765"><a href="#cb39-765" aria-hidden="true" tabindex="-1"></a>Les tokens sont régulièrement utilisés dans la programmation de routines (***.ado***), mais peuvent dans un programme courant s’avérer utile pour transformer les noms variables en macros. Le token est une macro qui prend comme expression une liste de numéros : <span class="in">`1', `</span>2', `3'……</span>
<span id="cb39-766"><a href="#cb39-766" aria-hidden="true" tabindex="-1"></a>On transforme une expression en token avec la commande **`tokenize`**.</span>
<span id="cb39-767"><a href="#cb39-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-768"><a href="#cb39-768" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-769"><a href="#cb39-769" aria-hidden="true" tabindex="-1"></a><span class="in">tokenize price mpg</span></span>
<span id="cb39-770"><a href="#cb39-770" aria-hidden="true" tabindex="-1"></a><span class="in">sum `1' `2'</span></span>
<span id="cb39-771"><a href="#cb39-771" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-772"><a href="#cb39-772" aria-hidden="true" tabindex="-1"></a><span class="in">    Variable |        Obs        Mean    Std. Dev.       Min        Max</span></span>
<span id="cb39-773"><a href="#cb39-773" aria-hidden="true" tabindex="-1"></a><span class="in">-------------+---------------------------------------------------------</span></span>
<span id="cb39-774"><a href="#cb39-774" aria-hidden="true" tabindex="-1"></a><span class="in">       price |         74    6165.257    2949.496       3291      15906</span></span>
<span id="cb39-775"><a href="#cb39-775" aria-hidden="true" tabindex="-1"></a><span class="in">         mpg |         74     21.2973    5.785503         12         41</span></span>
<span id="cb39-776"><a href="#cb39-776" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-777"><a href="#cb39-777" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-778"><a href="#cb39-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-779"><a href="#cb39-779" aria-hidden="true" tabindex="-1"></a>Ou avec une expression sous forme de macro:</span>
<span id="cb39-780"><a href="#cb39-780" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-781"><a href="#cb39-781" aria-hidden="true" tabindex="-1"></a><span class="in">local varlist price mpg</span></span>
<span id="cb39-782"><a href="#cb39-782" aria-hidden="true" tabindex="-1"></a><span class="in">tokenize `varlist'</span></span>
<span id="cb39-783"><a href="#cb39-783" aria-hidden="true" tabindex="-1"></a><span class="in">sum `1' `2'</span></span>
<span id="cb39-784"><a href="#cb39-784" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-785"><a href="#cb39-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-786"><a href="#cb39-786" aria-hidden="true" tabindex="-1"></a>Application pour un graphique:</span>
<span id="cb39-787"><a href="#cb39-787" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-788"><a href="#cb39-788" aria-hidden="true" tabindex="-1"></a><span class="in">local varlist price mpg foreign </span></span>
<span id="cb39-789"><a href="#cb39-789" aria-hidden="true" tabindex="-1"></a><span class="in">tokenize `varlist'</span></span>
<span id="cb39-790"><a href="#cb39-790" aria-hidden="true" tabindex="-1"></a><span class="in">tw scatter `1' `2' if !`3'</span></span>
<span id="cb39-791"><a href="#cb39-791" aria-hidden="true" tabindex="-1"></a><span class="in">|| scatter `1' `2' if  `3'</span></span>
<span id="cb39-792"><a href="#cb39-792" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-793"><a href="#cb39-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-794"><a href="#cb39-794" aria-hidden="true" tabindex="-1"></a><span class="fu">### **Variables temporaires**</span></span>
<span id="cb39-795"><a href="#cb39-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-796"><a href="#cb39-796" aria-hidden="true" tabindex="-1"></a>Variables, fichiers… peuvent être créés de manière temporaire. On regardera seulement les variables temporaires générées avec la fonction **`tempvar nom_variable`**, elles sont appelées sous forme de macro temporaire : `command `nom_variable'`. Principalement, elles permettent de générer des variables dont le nom n’entre pas en conflit avec des variables existantes, le nom enregistré étant de la forme** _00000#**, tout en n’alourdissanrpas artificiellement le contenu de la base.</span>
<span id="cb39-797"><a href="#cb39-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-798"><a href="#cb39-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-799"><a href="#cb39-799" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-800"><a href="#cb39-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-801"><a href="#cb39-801" aria-hidden="true" tabindex="-1"></a><span class="in">set obs 100</span></span>
<span id="cb39-802"><a href="#cb39-802" aria-hidden="true" tabindex="-1"></a><span class="in">number of observations (_N) was 0, now 100</span></span>
<span id="cb39-803"><a href="#cb39-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-804"><a href="#cb39-804" aria-hidden="true" tabindex="-1"></a><span class="in">tempvar x</span></span>
<span id="cb39-805"><a href="#cb39-805" aria-hidden="true" tabindex="-1"></a><span class="in">gen `x' = runiform() </span></span>
<span id="cb39-806"><a href="#cb39-806" aria-hidden="true" tabindex="-1"></a><span class="in">des</span></span>
<span id="cb39-807"><a href="#cb39-807" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-808"><a href="#cb39-808" aria-hidden="true" tabindex="-1"></a><span class="in">----------------------------------------------------------------------------------</span></span>
<span id="cb39-809"><a href="#cb39-809" aria-hidden="true" tabindex="-1"></a><span class="in">              storage   display    value</span></span>
<span id="cb39-810"><a href="#cb39-810" aria-hidden="true" tabindex="-1"></a><span class="in">variable name   type    format     label      variable label</span></span>
<span id="cb39-811"><a href="#cb39-811" aria-hidden="true" tabindex="-1"></a><span class="in">----------------------------------------------------------------------------------</span></span>
<span id="cb39-812"><a href="#cb39-812" aria-hidden="true" tabindex="-1"></a><span class="in">__000000        float   %9.0g </span></span>
<span id="cb39-813"><a href="#cb39-813" aria-hidden="true" tabindex="-1"></a><span class="in">----------------------------------------------------------------------------------       </span></span>
<span id="cb39-814"><a href="#cb39-814" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-815"><a href="#cb39-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-816"><a href="#cb39-816" aria-hidden="true" tabindex="-1"></a><span class="in">sum `x'</span></span>
<span id="cb39-817"><a href="#cb39-817" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-818"><a href="#cb39-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-819"><a href="#cb39-819" aria-hidden="true" tabindex="-1"></a><span class="in">    Variable |        Obs        Mean    Std. Dev.       Min        Max</span></span>
<span id="cb39-820"><a href="#cb39-820" aria-hidden="true" tabindex="-1"></a><span class="in">-------------+---------------------------------------------------------</span></span>
<span id="cb39-821"><a href="#cb39-821" aria-hidden="true" tabindex="-1"></a><span class="in">    __000000 |        100    .5253147    .2740814   .0073346   .9979447</span></span>
<span id="cb39-822"><a href="#cb39-822" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-823"><a href="#cb39-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-824"><a href="#cb39-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-825"><a href="#cb39-825" aria-hidden="true" tabindex="-1"></a><span class="in">tempvar x</span></span>
<span id="cb39-826"><a href="#cb39-826" aria-hidden="true" tabindex="-1"></a><span class="in">gen `x' = runiform()</span></span>
<span id="cb39-827"><a href="#cb39-827" aria-hidden="true" tabindex="-1"></a><span class="in">des</span></span>
<span id="cb39-828"><a href="#cb39-828" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-829"><a href="#cb39-829" aria-hidden="true" tabindex="-1"></a><span class="in">----------------------------------------------------------------------------------</span></span>
<span id="cb39-830"><a href="#cb39-830" aria-hidden="true" tabindex="-1"></a><span class="in">              storage   display    value</span></span>
<span id="cb39-831"><a href="#cb39-831" aria-hidden="true" tabindex="-1"></a><span class="in">variable name   type    format     label      variable label</span></span>
<span id="cb39-832"><a href="#cb39-832" aria-hidden="true" tabindex="-1"></a><span class="in">----------------------------------------------------------------------------------</span></span>
<span id="cb39-833"><a href="#cb39-833" aria-hidden="true" tabindex="-1"></a><span class="in">__000000        float   %9.0g                 </span></span>
<span id="cb39-834"><a href="#cb39-834" aria-hidden="true" tabindex="-1"></a><span class="in">__000001        float   %9.0g                 </span></span>
<span id="cb39-835"><a href="#cb39-835" aria-hidden="true" tabindex="-1"></a><span class="in">----------------------------------------------------------------------------------</span></span>
<span id="cb39-836"><a href="#cb39-836" aria-hidden="true" tabindex="-1"></a><span class="in">*/</span></span>
<span id="cb39-837"><a href="#cb39-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-838"><a href="#cb39-838" aria-hidden="true" tabindex="-1"></a><span class="in">/*</span></span>
<span id="cb39-839"><a href="#cb39-839" aria-hidden="true" tabindex="-1"></a><span class="in">sum `x'</span></span>
<span id="cb39-840"><a href="#cb39-840" aria-hidden="true" tabindex="-1"></a><span class="in">    Variable |        Obs        Mean    Std. Dev.       Min        Max</span></span>
<span id="cb39-841"><a href="#cb39-841" aria-hidden="true" tabindex="-1"></a><span class="in">-------------+---------------------------------------------------------</span></span>
<span id="cb39-842"><a href="#cb39-842" aria-hidden="true" tabindex="-1"></a><span class="in">    __000001 |        100     .471744    .2926945   .0028599   .9711645</span></span>
<span id="cb39-843"><a href="#cb39-843" aria-hidden="true" tabindex="-1"></a><span class="in">*/    </span></span>
<span id="cb39-844"><a href="#cb39-844" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb39-845"><a href="#cb39-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-846"><a href="#cb39-846" aria-hidden="true" tabindex="-1"></a>***Graphique***  </span>
<span id="cb39-847"><a href="#cb39-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-848"><a href="#cb39-848" aria-hidden="true" tabindex="-1"></a>On va de nouveau représenter un nuage de points, entre la variable ***price*** et la variable ***displacement***. La couleur des bulles représente l’appartenance à un quartile de la variable displacement.  </span>
<span id="cb39-849"><a href="#cb39-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-850"><a href="#cb39-850" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata, eval=FALSE}</span></span>
<span id="cb39-851"><a href="#cb39-851" aria-hidden="true" tabindex="-1"></a><span class="in">sysuse auto, clear</span></span>
<span id="cb39-852"><a href="#cb39-852" aria-hidden="true" tabindex="-1"></a><span class="in">tempvar qdisp</span></span>
<span id="cb39-853"><a href="#cb39-853" aria-hidden="true" tabindex="-1"></a><span class="in">local varlist price displacement `qdisp'</span></span>
<span id="cb39-854"><a href="#cb39-854" aria-hidden="true" tabindex="-1"></a><span class="in">tokenize `varlist'</span></span>
<span id="cb39-855"><a href="#cb39-855" aria-hidden="true" tabindex="-1"></a><span class="in">qui xtile `qdisp' = `2', n(4)</span></span>
<span id="cb39-856"><a href="#cb39-856" aria-hidden="true" tabindex="-1"></a><span class="in">qui sum `2', d</span></span>
<span id="cb39-857"><a href="#cb39-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-858"><a href="#cb39-858" aria-hidden="true" tabindex="-1"></a><span class="in">#delimit ;</span></span>
<span id="cb39-859"><a href="#cb39-859" aria-hidden="true" tabindex="-1"></a><span class="in">tw scatter `1' `2' if `3'==1,</span></span>
<span id="cb39-860"><a href="#cb39-860" aria-hidden="true" tabindex="-1"></a><span class="in">   mlc(black) mlw(*.5) mc("68 1 84%60")    msiz(*1.5) jitter(1)</span></span>
<span id="cb39-861"><a href="#cb39-861" aria-hidden="true" tabindex="-1"></a><span class="in">|| scatter `1' `2' if `3'==2,</span></span>
<span id="cb39-862"><a href="#cb39-862" aria-hidden="true" tabindex="-1"></a><span class="in">   mlc(black) mlw(*.5) mc("49 104 142%60") msiz(*1.5) jitter(1)</span></span>
<span id="cb39-863"><a href="#cb39-863" aria-hidden="true" tabindex="-1"></a><span class="in">|| scatter `1' `2' if `3'==4,</span></span>
<span id="cb39-864"><a href="#cb39-864" aria-hidden="true" tabindex="-1"></a><span class="in">   mlc(black) mlw(*.5) mc("53 183 121%60") msiz(*1.5) jitter(1)</span></span>
<span id="cb39-865"><a href="#cb39-865" aria-hidden="true" tabindex="-1"></a><span class="in">|| scatter `1' `2' if `3'==3,</span></span>
<span id="cb39-866"><a href="#cb39-866" aria-hidden="true" tabindex="-1"></a><span class="in">   mlc(black) mlw(*.5) mc("253 231 37%60") msiz(*1.5) jitter(1)</span></span>
<span id="cb39-867"><a href="#cb39-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-868"><a href="#cb39-868" aria-hidden="true" tabindex="-1"></a><span class="in">||, legend(off) </span></span>
<span id="cb39-869"><a href="#cb39-869" aria-hidden="true" tabindex="-1"></a><span class="in">    xlabel(`r(p25)' "`r(p25)'" `r(p50)' "`r(p50)'" `r(p75)' "`r(p75)'")</span></span>
<span id="cb39-870"><a href="#cb39-870" aria-hidden="true" tabindex="-1"></a><span class="in">;</span></span>
<span id="cb39-871"><a href="#cb39-871" aria-hidden="true" tabindex="-1"></a><span class="in">````</span></span>
<span id="cb39-872"><a href="#cb39-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-873"><a href="#cb39-873" aria-hidden="true" tabindex="-1"></a><span class="al">![Utilisation des tokens et des variables temporaires](imgp2/g4.png)</span>{width=60%}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Marc Thévenin / Ined-Sms / Août 2022-</div>
  </div>
</footer>



</body></html>